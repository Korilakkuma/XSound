!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";function i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}s.r(e);class r{constructor(t){this.sampleRate=t,this.isActive=!1,this.graphics="",this.canvas=null,this.context=null,this.svg=null,this.interval=1e3,this.timerid=null,this.styles={shape:"line",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0, 0, 255, 1.0)"}],wave:"rgba(0, 0, 255, 1.0)",grid:"rgba(255, 0, 0, 1.0)",text:"rgba(255, 255, 255, 1.0)",font:{family:"Arial",size:"13px",style:"normal",weight:"normal"},width:1.5,cap:"round",join:"miter",top:15,right:30,bottom:15,left:30}}setup(t){return t instanceof HTMLCanvasElement?(this.graphics=r.CANVAS,this.canvas=t,this.context=this.canvas.getContext("2d")):t instanceof SVGElement&&(this.graphics=r.SVG,this.svg=t),this}param(t,e){const s=String(t).replace(/-/g,"").toLowerCase();let i=null;switch(s){case"interval":if(void 0===e)return this.interval;"auto"===String(e).toLowerCase()?this.interval="auto":(i=parseFloat(e))>=0&&(this.interval=i);break;case"shape":if(void 0===e)return this.styles.shape;"line"!==(i=String(e).toLowerCase())&&"rect"!==i||(this.styles.shape="gradient"!==this.styles.wave?i:"rect");break;case"grad":if(void 0===e)return this.styles.grad;Array.isArray(e)||(e=[e]);let t=!1;for(const s of e){if(!("offset"in s&&"color"in s)){t=!0;break}{const e=parseFloat(s.offset);if(isNaN(e)||e<0||e>1){t=!0;break}}}t||(this.styles.grad=e);break;case"font":if(void 0===e)return this.styles[s];if("[object Object]"===Object.prototype.toString.call(e))for(const t in e)/family|size|style|weight/i.test(t)&&(this.styles.font[t]=String(e[t]));break;case"wave":case"grid":case"text":case"cap":case"join":if(void 0===e)return this.styles[s];"string"==typeof e&&("wave"===s&&"gradient"===e&&(this.styles.shape="rect"),this.styles[s]=e.toLowerCase());break;case"width":case"top":case"right":case"bottom":case"left":if(void 0===e)return this.styles[s];(i="width"===s?parseFloat(e):parseInt(e,10))>=0&&(this.styles[s]=i)}}start(t,e,s){switch(this.graphics){case r.CANVAS:this.drawOnCanvas(t,e,s);break;case r.SVG:this.drawBySVG(t,e,s)}return this}create(){switch(this.graphics){case r.CANVAS:return this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");case r.SVG:return this.svg.outerHTML;default:return this}}state(t){return void 0===t?this.isActive:("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this)}drawTimeDomainFloat32ArrayOnCanvas(t,e,s,i,r,n){if(!(t instanceof CanvasRenderingContext2D))return this;if(!(e instanceof Float32Array))return this;let a=parseInt(s,10),o=parseInt(i,10),c=parseInt(r,10);switch(isNaN(a)&&(a=0),isNaN(o)&&(o=0),isNaN(c)&&(c=0),this.styles.shape){case"line":t.strokeStyle=this.styles.wave,t.lineWidth=this.styles.width,t.lineCap=this.styles.cap,t.lineJoin=this.styles.join,t.beginPath();for(let s=0,i=e.length;s<i;s++)if(null==n||s%n==0){const r=s/i*a+this.styles.left,n=(1-e[s])*(o/2)+this.styles.top;0===s?t.moveTo(r+this.styles.width/2,n):t.lineTo(r,n)}t.stroke();break;case"rect":"gradient"!==this.styles.wave&&(t.fillStyle=this.styles.wave);for(let s=0,r=e.length;s<r;s++)if(null==n||s%n==0){const n=s/r*a+this.styles.left,l=e[s]*(o/2)*-1;if("gradient"===this.styles.wave){const e=i/2+this.styles.top,s=t.createLinearGradient(0,e,0,e+l);for(const t of this.styles.grad)s.addColorStop(t.offset,t.color);t.fillStyle=s}t.fillRect(n,c,this.styles.width,l)}}return this}drawTimeDomainFloat32ArrayBySVG(t,e,s,i,n,a){let o=parseInt(e,10),c=parseInt(s,10),l=parseInt(i,10);switch(isNaN(o)&&(o=0),isNaN(c)&&(c=0),isNaN(l)&&(l=0),this.styles.shape){case"line":const e=document.createElementNS(r.XMLNS,"path");let i="";for(let e=0,s=t.length;e<s;e++)if(null==n||e%n==0){const r=e/s*o+this.styles.left,n=(1-t[e])*(c/2)+this.styles.top;i+=0===e?`M${r+this.styles.width/2} ${n}`:` L${r} ${n}`}return e.setAttribute("d",i),e.setAttribute("stroke",this.styles.wave),e.setAttribute("fill","none"),e.setAttribute("stroke-width",this.styles.width),e.setAttribute("stroke-linecap",this.styles.cap),e.setAttribute("stroke-linejoin",this.styles.join),e;case"rect":let h=null;"gradient"===this.styles.wave&&(h=this.createSVGLinearGradient(a));const u=document.createElementNS(r.XMLNS,"g");null!==h&&u.appendChild(h);for(let e=0,i=t.length;e<i;e++)if(null==n||e%n==0){const n=document.createElementNS(r.XMLNS,"rect"),c=e/i*o+this.styles.left,p=t[e]*(s/2);n.setAttribute("x",c),n.setAttribute("y",l),n.setAttribute("width",this.styles.width),p<0?n.setAttribute("height",-p):(n.setAttribute("height",p),n.setAttribute("transform",`rotate(180 ${c+this.styles.width/2} ${l})`)),n.setAttribute("stroke","none"),n.setAttribute("fill",null===h?this.styles.wave:`url(#${a})`),u.appendChild(n)}return u;default:return null}}createSVGLinearGradient(t){const e=document.createElementNS(r.XMLNS,"defs"),s=document.createElementNS(r.XMLNS,"linearGradient");s.setAttribute("id",String(t)),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","0%"),s.setAttribute("y2","100%");for(const t of this.styles.grad){const e=document.createElementNS(r.XMLNS,"stop");e.setAttribute("offset",t.offset),e.setAttribute("stop-color",t.color),s.appendChild(e)}return e.appendChild(s),e}createFontString(){const{size:t,style:e,weight:s,family:i}=this.styles.font;return`${t} ${e} ${s} "${i}"`}drawOnCanvas(){}drawBySVG(){}toString(){return"[SoundModule Analyser Visualizer]"}}i(r,"CANVAS","canvas"),i(r,"SVG","svg"),i(r,"XMLNS","http://www.w3.org/2000/svg"),i(r,"XLINK","http://www.w3.org/1999/xlink"),i(r,"SVG_LINEAR_GRADIENT_ID_TIME_OVERVIEW","svg-linear-gradient-time-overview"),i(r,"SVG_LINEAR_GRADIENT_ID_TIME","svg-linear-gradient-time"),i(r,"SVG_LINEAR_GRADIENT_ID_FFT","svg-linear-gradient-fft");class n extends r{constructor(t){super(t),this.savedImage=null,this.length=0,this.currentTime="rgba(0, 0, 0, 0.5)",this.plotInterval=.0625,this.textInterval=60}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r=null;switch(s){case"currenttime":if(void 0===e)return this.currentTime;this.currentTime=String(e).toLowerCase();break;case"plotinterval":case"textinterval":if(void 0===e)return this[s.replace("interval","Interval")];(r=parseFloat(e))>0&&(this[s.replace("interval","Interval")]=r)}}return this}drawOnCanvas(t){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;const e=this.context,{width:s,height:i}=this.canvas,r=s-(this.styles.left+this.styles.right),n=i-(this.styles.top+this.styles.bottom),a=Math.floor(n/2)+this.styles.top,o=Math.floor(this.plotInterval*this.sampleRate),c=Math.floor(this.textInterval*this.sampleRate);if(e.clearRect(0,0,s,i),this.drawTimeDomainFloat32ArrayOnCanvas(e,t,r,n,a,o),"none"!==this.styles.grid||"none"!==this.styles.text){for(let s=0,i=t.length;s<i;s++)if(s%c==0){const t=Math.floor(s/i*r)+this.styles.left,a=`${Math.floor(s/this.sampleRate/60)} min`;"none"!==this.styles.grid&&(e.fillStyle=this.styles.grid,e.fillRect(t,this.styles.top,1,n)),"none"!==this.styles.text&&(e.fillStyle=this.styles.text,e.font=this.createFontString(),e.fillText(a,t-e.measureText(a).width/2,this.styles.top+n+parseInt(this.styles.font.size,10)))}const s=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];for(const t of s){const s=Math.floor(this.styles.left-e.measureText(t).width),i=Math.floor((1-parseFloat(t.trim()))*(n/2))+this.styles.top;"none"!==this.styles.grid&&(e.fillStyle=this.styles.grid,e.fillRect(this.styles.left,i,r,1)),"none"!==this.styles.text&&(e.fillStyle=this.styles.text,e.font=this.createFontString(),e.fillText(t,s,i-Math.floor(parseInt(this.styles.font.size,10)/4)))}}return this.savedImage=e.getImageData(0,0,s,i),this.length=t.length,e.fillStyle=this.currentTime,e.fillRect(this.styles.left,this.styles.top,1,n),this}drawBySVG(t){if(!(this.svg instanceof SVGElement&&this.isActive))return this;const e=this.svg,s=parseInt(e.getAttribute("width"),10),i=parseInt(e.getAttribute("height"),10),a=s-(this.styles.left+this.styles.right),o=i-(this.styles.top+this.styles.bottom),c=Math.floor(o/2)+this.styles.top,l=Math.floor(this.plotInterval*this.sampleRate),h=Math.floor(this.textInterval*this.sampleRate);if(e.innerHTML="",e.appendChild(this.drawTimeDomainFloat32ArrayBySVG(t,a,o,c,l,r.SVG_LINEAR_GRADIENT_ID_TIME_OVERVIEW)),"none"!==this.styles.grid||"none"!==this.styles.text){for(let s=0,i=t.length;s<i;s++)if(s%h==0){const t=Math.floor(s/i*a)+this.styles.left,n=Math.floor(s/this.sampleRate/60)+" min";if("none"!==this.styles.grid){const s=document.createElementNS(r.XMLNS,"rect");s.setAttribute("x",t),s.setAttribute("y",this.styles.top),s.setAttribute("width",1),s.setAttribute("height",o),s.setAttribute("stroke","none"),s.setAttribute("fill",this.styles.grid),e.appendChild(s)}if("none"!==this.styles.text){const s=document.createElementNS(r.XMLNS,"text");s.textContent=n,s.setAttribute("x",t),s.setAttribute("y",this.styles.top+o+parseInt(this.styles.font.size,10)),s.setAttribute("text-anchor","middle"),s.setAttribute("stroke","none"),s.setAttribute("fill",this.styles.text),s.setAttribute("font-family",this.styles.font.family),s.setAttribute("font-size",this.styles.font.size),s.setAttribute("font-style",this.styles.font.style),s.setAttribute("font-weight",this.styles.font.weight),e.appendChild(s)}}const s=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];for(const t of s){const s=this.styles.left,i=Math.floor((1-parseFloat(t.trim()))*(o/2))+this.styles.top;if("none"!==this.styles.grid){const t=document.createElementNS(r.XMLNS,"rect");t.setAttribute("x",s),t.setAttribute("y",i),t.setAttribute("width",a),t.setAttribute("height",1),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),e.appendChild(t)}if("none"!==this.styles.text){const n=document.createElementNS(r.XMLNS,"text");n.textContent=t,n.setAttribute("x",s),n.setAttribute("y",i-Math.floor(parseInt(this.styles.font.size,10)/4)),n.setAttribute("text-anchor","end"),n.setAttribute("stroke","none"),n.setAttribute("fill",this.styles.text),n.setAttribute("font-family",this.styles.font.family),n.setAttribute("font-size",this.styles.font.size),n.setAttribute("font-style",this.styles.font.style),n.setAttribute("font-weight",this.styles.font.weight),e.appendChild(n)}}}const u=document.createElementNS(r.XMLNS,"rect");return u.classList.add(n.SVG_CURRENT_TIME_CLASS_NAME),u.setAttribute("x",this.styles.left),u.setAttribute("y",this.styles.top+1),u.setAttribute("height",o-1),u.setAttribute("stroke","none"),u.setAttribute("fill",this.currentTime),u.setAttribute("aria-label","current time"),e.appendChild(u),this.savedImage=e,this.length=t.length,this}update(t){const e=parseFloat(t);if(isNaN(e)||e<0)return this;switch(this.graphics){case r.CANVAS:if(this.savedImage instanceof ImageData){const t=this.context,{width:s,height:i}=this.canvas,r=s-(this.styles.left+this.styles.right),n=i-(this.styles.top+this.styles.bottom),a=Math.floor(e*this.sampleRate/this.length*r);t.clearRect(0,0,s,i),t.putImageData(this.savedImage,0,0),t.fillStyle=this.currentTime,t.fillRect(this.styles.left,this.styles.top+1,a,n-1)}break;case r.SVG:const t=this.svg.querySelector(`.${n.SVG_CURRENT_TIME_CLASS_NAME}`);if(t instanceof SVGElement){const s=parseInt(this.svg.getAttribute("width"),10)-(this.styles.left+this.styles.right),i=e*this.sampleRate/this.length*s;t.setAttribute("width",i)}}return this}drag(t){let e=null,s="",i="",n="";switch(/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(s="touchstart",i="touchmove",n="touchend"):(s="mousedown",i="mousemove",n="mouseup"),this.graphics){case r.CANVAS:e=this.canvas;break;case r.SVG:e=this.svg;break;default:return this}let a=!1;return e.addEventListener(s,e=>{this.draw(this.getOffsetX(e),t),a=!0},!0),e.addEventListener(i,e=>{a&&(e.preventDefault(),this.draw(this.getOffsetX(e),t))},!0),window.addEventListener(n,()=>{a&&(a=!1)},!0),this}draw(t,e){let s=0,i=0;switch(this.graphics){case r.CANVAS:s=this.canvas.offsetLeft,i=this.canvas.width;break;case r.SVG:s=this.svg.parentNode.offsetLeft,i=parseInt(this.svg.getAttribute("width"),10)}let n=t-(s+this.styles.left);n<0&&(n=0),n>(i-=this.styles.left+this.styles.right)&&(n=i);const a=n/i*this.length/this.sampleRate;return this.update(a),"[object Function]"===Object.prototype.toString.call(e)&&e(a),this}getOffsetX(t){return t.pageX?t.pageX:t.touches[0]?t.touches[0].pageX:this}toString(){return"[SoundModule Analyser TimeOverview]"}}var a,o,c;function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}c="xsound-svg-current-time",(o="SVG_CURRENT_TIME_CLASS_NAME")in(a=n)?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c;class h extends r{constructor(t){super(t),this.type=h.UINT,this.textInterval=.005}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r=null;switch(s){case"type":if(void 0===e)return this.type;(r=String(e).toLowerCase())!==h.UINT&&r!==h.FLOAT||(this.type=r);break;case"textinterval":if(void 0===e)return this.textInterval;(r=parseFloat(e))>0&&(this.textInterval=r)}}return this}drawOnCanvas(t){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;const e=this.context,{width:s,height:i}=this.canvas,r=s-(this.styles.left+this.styles.right),n=i-(this.styles.top+this.styles.bottom),a=Math.floor(n/2)+this.styles.top,o=Math.floor(this.textInterval*this.sampleRate);switch(e.clearRect(0,0,s,i),this.type){case h.FLOAT:this.drawTimeDomainFloat32ArrayOnCanvas(e,t,r,n,a);break;case h.UINT:default:switch(this.styles.shape){case"line":e.strokeStyle=this.styles.wave,e.lineWidth=this.styles.width,e.lineCap=this.styles.cap,e.lineJoin=this.styles.join,e.beginPath();for(let s=0,i=t.length;s<i;s++){const a=s/i*r+this.styles.left,o=(1-t[s]/255)*n+this.styles.top;0===s?e.moveTo(a+this.styles.width/2,o):e.lineTo(a,o)}e.stroke();break;case"rect":"gradient"!==this.styles.wave&&(e.fillStyle=this.styles.wave);for(let s=0,i=t.length;s<i;s++){const o=s/i*r+this.styles.left,c=(.5-t[s]/255)*n;if("gradient"===this.styles.wave){const t=n/2+this.styles.top,s=e.createLinearGradient(0,t,0,t+c);for(const t of this.styles.grad)s.addColorStop(t.offset,t.color);e.fillStyle=s}e.fillRect(o,a,this.styles.width,c)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(let s=0,i=t.length;s<i;s++)if(s%o==0){const t=Math.ceil(s/i*r)+this.styles.left,a=`${Math.ceil(s/this.sampleRate*1e3)} ms`;"none"!==this.styles.grid&&(e.fillStyle=this.styles.grid,e.fillRect(t,this.styles.top,1,n)),"none"!==this.styles.text&&(e.fillStyle=this.styles.text,e.font=this.createFontString(),e.fillText(a,t-e.measureText(a).width/2,this.styles.top+n+parseInt(this.styles.font.size,10)))}const s=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];for(const t of s){const s=Math.floor(this.styles.left-e.measureText(t).width),i=Math.floor((1-parseFloat(t.trim()))*(n/2))+this.styles.top;"none"!==this.styles.grid&&(e.fillStyle=this.styles.grid,e.fillRect(this.styles.left,i,r,1)),"none"!==this.styles.text&&(e.fillStyle=this.styles.text,e.font=this.createFontString(),e.fillText(t,s,i-Math.floor(parseInt(this.styles.font.size,10)/4)))}}return this}drawBySVG(t){if(!(this.svg instanceof SVGElement&&this.isActive))return this;const e=this.svg,s=parseInt(e.getAttribute("width"),10),i=parseInt(e.getAttribute("height"),10),n=s-(this.styles.left+this.styles.right),a=i-(this.styles.top+this.styles.bottom),o=Math.floor(a/2)+this.styles.top,c=Math.floor(this.textInterval*this.sampleRate);switch(e.innerHTML="",this.type){case h.FLOAT:e.appendChild(this.drawTimeDomainFloat32ArrayBySVG(t,n,a,o,null,r.SVG_LINEAR_GRADIENT_ID_TIME));break;case h.UINT:default:switch(this.styles.shape){case"line":const s=document.createElementNS(r.XMLNS,"path");let i="";for(let e=0,s=t.length;e<s;e++){const r=e/s*n+this.styles.left,o=(1-t[e]/255)*a+this.styles.top;i+=0===e?`M${r+this.styles.width/2} ${o}`:` L${r} ${o}`}s.setAttribute("d",i),s.setAttribute("stroke",this.styles.wave),s.setAttribute("fill","none"),s.setAttribute("stroke-width",this.styles.width),s.setAttribute("stroke-linecap",this.styles.cap),s.setAttribute("stroke-linejoin",this.styles.join),e.appendChild(s);break;case"rect":let c=null;"gradient"===this.styles.wave&&(c=this.createSVGLinearGradient(r.SVG_LINEAR_GRADIENT_ID_TIME));const l=document.createElementNS(r.XMLNS,"g");null!==c&&l.appendChild(c);for(let e=0,s=t.length;e<s;e++){const i=document.createElementNS(r.XMLNS,"rect"),h=e/s*n+this.styles.left,u=(t[e]/255-.5)*a;i.setAttribute("x",h),i.setAttribute("y",o),i.setAttribute("width",this.styles.width),u<0?i.setAttribute("height",-u):(i.setAttribute("height",u),i.setAttribute("transform",`rotate(180 ${h+this.styles.width/2} ${o})`)),i.setAttribute("stroke","none"),i.setAttribute("fill",null===c?this.styles.wave:`url(#${r.SVG_LINEAR_GRADIENT_ID_TIME})`),l.appendChild(i)}e.appendChild(l)}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(let s=0,i=t.length;s<i;s++)if(s%c==0){const t=Math.ceil(s/i*n)+this.styles.left,o=`${Math.ceil(s/this.sampleRate*1e3)} ms`;if("none"!==this.styles.grid){const s=document.createElementNS(r.XMLNS,"rect");s.setAttribute("x",t),s.setAttribute("y",this.styles.top),s.setAttribute("width",1),s.setAttribute("height",a),s.setAttribute("stroke","none"),s.setAttribute("fill",this.styles.grid),e.appendChild(s)}if("none"!==this.styles.text){const s=document.createElementNS(r.XMLNS,"text");s.textContent=o,s.setAttribute("x",t),s.setAttribute("y",this.styles.top+a+parseInt(this.styles.font.size,10)),s.setAttribute("text-anchor","middle"),s.setAttribute("stroke","none"),s.setAttribute("fill",this.styles.text),s.setAttribute("font-family",this.styles.font.family),s.setAttribute("font-size",this.styles.font.size),s.setAttribute("font-style",this.styles.font.style),s.setAttribute("font-weight",this.styles.font.weight),e.appendChild(s)}}const s=["-1.00","-0.50"," 0.00"," 0.50"," 1.00"];for(const t of s){const s=this.styles.left,i=Math.floor((1-parseFloat(t.trim()))*(a/2))+this.styles.top;if("none"!==this.styles.grid){const t=document.createElementNS(r.XMLNS,"rect");t.setAttribute("x",s),t.setAttribute("y",i),t.setAttribute("width",n),t.setAttribute("height",1),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),e.appendChild(t)}if("none"!==this.styles.text){const n=document.createElementNS(r.XMLNS,"text");n.textContent=t,n.setAttribute("x",s),n.setAttribute("y",i-Math.floor(parseInt(this.styles.font.size,10)/4)),n.setAttribute("text-anchor","end"),n.setAttribute("stroke","none"),n.setAttribute("fill",this.styles.text),n.setAttribute("font-family",this.styles.font.family),n.setAttribute("font-size",this.styles.font.size),n.setAttribute("font-style",this.styles.font.style),n.setAttribute("font-weight",this.styles.font.weight),e.appendChild(n)}}}return this}toString(){return"[SoundModule Analyser Time]"}}function u(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}l(h,"UINT","uint"),l(h,"FLOAT","float");class p extends r{constructor(t){super(t),this.type=p.UINT,this.size=256,this.textInterval=1e3}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r=null,n=null,a=null;switch(s){case"type":if(void 0===e)return this.type;(r=String(e).toLowerCase())!==p.UINT&&r!==p.FLOAT||(this.type=r);break;case"size":if(void 0===e)return this.size;r=parseInt(e,10),a=1024,r>(n=0)&&r<=a&&(this.size=r);break;case"textinterval":if(void 0===e)return this.textInterval;(r=parseFloat(e))>0&&(this.textInterval=r)}}return this}drawOnCanvas(t,e,s){if(!(this.canvas instanceof HTMLCanvasElement&&this.isActive))return this;const i=parseFloat(e),r=parseFloat(s),n=r-i,a=this.context,{width:o,height:c}=this.canvas,l=o-(this.styles.left+this.styles.right),h=c-(this.styles.top+this.styles.bottom),u=this.size>t.length?t.length:this.size,f=this.sampleRate/(2*t.length),d=Math.floor(this.textInterval/f);switch(a.clearRect(0,0,o,c),this.type){case p.FLOAT:a.strokeStyle="gradient"!==this.styles.wave?this.styles.wave:"rgba(0, 0, 255, 1.0)",a.lineWidth=this.styles.width,a.lineCap=this.styles.cap,a.lineJoin=this.styles.join,a.beginPath();for(let e=0;e<u;e++){const s=e/u*l+this.styles.left,i=Math.abs(t[e]-r)*(h/n)+this.styles.top;0===e?a.moveTo(s+this.styles.width/2,i):a.lineTo(s,i)}a.stroke();break;case p.UINT:default:switch(this.styles.shape){case"line":a.strokeStyle=this.styles.wave,a.lineWidth=this.styles.width,a.lineCap=this.styles.cap,a.lineJoin=this.styles.join,a.beginPath();for(let e=0;e<u;e++){const s=e/u*l+this.styles.left,i=(1-t[e]/255)*h+this.styles.top;0===e?a.moveTo(s+this.styles.width/2,i):a.lineTo(s,i)}a.stroke();break;case"rect":"gradient"!==this.styles.wave&&(a.fillStyle=this.styles.wave);for(let e=0;e<u;e++){const s=e/u*l+this.styles.left,i=t[e]/255*h*-1;if("gradient"===this.styles.wave){const t=h+this.styles.top,e=a.createLinearGradient(0,t,0,t+i);for(const t of this.styles.grad)e.addColorStop(t.offset,t.color);a.fillStyle=e}a.fillRect(s,h+this.styles.top,this.styles.width,i)}}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(let t=0;t<u;t++)if(t%d==0){const e=Math.floor(t/u*l)+this.styles.left,s=Math.floor(this.textInterval*(t/d)),i=s<1e3?`${s} Hz`:`${String(s/1e3).slice(0,3)} kHz`;"none"!==this.styles.grid&&(a.fillStyle=this.styles.grid,a.fillRect(e,this.styles.top,1,h)),"none"!==this.styles.text&&(a.fillStyle=this.styles.text,a.font=this.createFontString(),a.fillText(i,e-a.measureText(i).width/2,this.styles.top+h+parseInt(this.styles.font.size,10)))}switch(this.type){case p.FLOAT:for(let t=i;t<=r;t+=10){const e=`${t} dB`,s=Math.floor(this.styles.left-a.measureText(e).width),i=Math.floor(-1*(t-r)/n*h)+this.styles.top;"none"!==this.styles.grid&&(a.fillStyle=this.styles.grid,a.fillRect(this.styles.left,i,l,1)),"none"!==this.styles.text&&(a.fillStyle=this.styles.text,a.font=this.createFontString(),a.fillText(e,s,i-Math.floor(parseInt(this.styles.font.size,10)/4)))}break;case p.UINT:default:const t=["0.00","0.25","0.50","0.75","1.00"];for(const e of t){const t=Math.floor(this.styles.left-a.measureText(e).width),s=(1-parseFloat(e))*h+this.styles.top;"none"!==this.styles.grid&&(a.fillStyle=this.styles.grid,a.fillRect(this.styles.left,s,l,1)),"none"!==this.styles.text&&(a.fillStyle=this.styles.text,a.font=this.createFontString(),a.fillText(e,t,s-Math.floor(parseInt(this.styles.font.size,10)/4)))}}}return this}drawBySVG(t,e,s){if(!(this.svg instanceof SVGElement&&this.isActive))return this;const i=parseFloat(e),n=parseFloat(s),a=n-i,o=this.svg,c=parseInt(o.getAttribute("width"),10),l=parseInt(o.getAttribute("height"),10),h=c-(this.styles.left+this.styles.right),u=l-(this.styles.top+this.styles.bottom),f=this.size>t.length?t.length:this.size,d=this.sampleRate/(2*t.length),m=Math.floor(this.textInterval/d);switch(o.innerHTML="",this.type){case p.FLOAT:const e=document.createElementNS(r.XMLNS,"path");let s="";for(let e=0;e<f;e++){const i=Math.floor(e/f*h)+this.styles.left,r=Math.floor(-1*(t[e]-n)*(u/a))+this.styles.top;s+=0===e?`M${i+this.styles.width/2} ${r}`:` L${i} ${r}`}e.setAttribute("d",s),e.setAttribute("stroke","gradient"!==this.styles.wave?this.styles.wave:"rgba(0, 0, 255, 1.0)"),e.setAttribute("fill","none"),e.setAttribute("stroke-width",this.styles.width),e.setAttribute("stroke-linecap",this.styles.cap),e.setAttribute("stroke-linejoin",this.styles.join),o.appendChild(e);break;case p.UINT:default:switch(this.styles.shape){case"line":const e=document.createElementNS(r.XMLNS,"path");let s="";for(let e=0;e<f;e++){const i=Math.floor(e/f*h)+this.styles.left,r=Math.floor((1-t[e]/255)*u)+this.styles.top;s+=0===e?`M${i+this.styles.width/2} ${r}`:` L${i} ${r}`}e.setAttribute("d",s),e.setAttribute("stroke",this.styles.wave),e.setAttribute("fill","none"),e.setAttribute("stroke-width",this.styles.width),e.setAttribute("stroke-linecap",this.styles.cap),e.setAttribute("stroke-linejoin",this.styles.join),o.appendChild(e);break;case"rect":let i=null;"gradient"===this.styles.wave&&(i=this.createSVGLinearGradient(r.SVG_LINEAR_GRADIENT_ID_FFT));const n=document.createElementNS(r.XMLNS,"g");null!==i&&n.appendChild(i);for(let e=0;e<f;e++){let s=document.createElementNS(r.XMLNS,"rect");const a=Math.floor(e/f*h)+this.styles.left,o=Math.floor(t[e]/255*u);s.setAttribute("x",a),s.setAttribute("y",this.styles.top+u),s.setAttribute("width",this.styles.width),o<0?s.setAttribute("height",-o):(s.setAttribute("height",o),s.setAttribute("transform",`rotate(180 ${a+this.styles.width/2} ${this.styles.top+u})`)),s.setAttribute("stroke","none"),s.setAttribute("fill",null===i?this.styles.wave:`url(#${r.SVG_LINEAR_GRADIENT_ID_FFT})`),n.appendChild(s)}o.appendChild(n)}}if("none"!==this.styles.grid||"none"!==this.styles.text){for(let t=0;t<f;t++)if(t%m==0){const e=Math.floor(t/f*h)+this.styles.left,s=Math.floor(this.textInterval*(t/m)),i=s<1e3?`${s} Hz`:`${String(s/1e3).slice(0,3)} kHz`;if("none"!==this.styles.grid){const t=document.createElementNS(r.XMLNS,"rect");t.setAttribute("x",e),t.setAttribute("y",this.styles.top),t.setAttribute("width",1),t.setAttribute("height",u),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),o.appendChild(t)}if("none"!==this.styles.text){const t=document.createElementNS(r.XMLNS,"text");t.textContent=i,t.setAttribute("x",e),t.setAttribute("y",this.styles.top+u+parseInt(this.styles.font.size,10)),t.setAttribute("text-anchor","middle"),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.text),t.setAttribute("font-family",this.styles.font.family),t.setAttribute("font-size",this.styles.font.size),t.setAttribute("font-style",this.styles.font.style),t.setAttribute("font-weight",this.styles.font.weight),o.appendChild(t)}}switch(this.type){case p.FLOAT:for(let t=i;t<=n;t+=10){const e=`${t}dB`,s=this.styles.left,i=Math.floor(-1*(t-n)/a*u)+this.styles.top;if("none"!==this.styles.grid){const t=document.createElementNS(r.XMLNS,"rect");t.setAttribute("x",s),t.setAttribute("y",i),t.setAttribute("width",h),t.setAttribute("height",1),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.grid),o.appendChild(t)}if("none"!==this.styles.text){const t=document.createElementNS(r.XMLNS,"text");t.textContent=e,t.setAttribute("x",s),t.setAttribute("y",i-Math.floor(parseInt(this.styles.font.size,10)/4)),t.setAttribute("text-anchor","end"),t.setAttribute("stroke","none"),t.setAttribute("fill",this.styles.text),t.setAttribute("font-family",this.styles.font.family),t.setAttribute("font-size",this.styles.font.size),t.setAttribute("font-style",this.styles.font.style),t.setAttribute("font-weight",this.styles.font.weight),o.appendChild(t)}}break;case p.UINT:default:const t=["0.00","0.25","0.50","0.75","1.00"];for(const e of t){const t=this.styles.left,s=(1-parseFloat(e))*u+this.styles.top;if("none"!==this.styles.grid){const e=document.createElementNS(r.XMLNS,"rect");e.setAttribute("x",t),e.setAttribute("y",s),e.setAttribute("width",h),e.setAttribute("height",1),e.setAttribute("stroke","none"),e.setAttribute("fill",this.styles.grid),o.appendChild(e)}if("none"!==this.styles.text){const i=document.createElementNS(r.XMLNS,"text");i.textContent=e,i.setAttribute("x",t),i.setAttribute("y",s-Math.floor(parseInt(this.styles.font.size,10)/4)),i.setAttribute("text-anchor","end"),i.setAttribute("stroke","none"),i.setAttribute("fill",this.styles.text),i.setAttribute("font-family",this.styles.font.family),i.setAttribute("font-size",this.styles.font.size),i.setAttribute("font-style",this.styles.font.style),i.setAttribute("font-weight",this.styles.font.weight),o.appendChild(i)}}}}return this}toString(){return"[SoundModule Analyser FFT]"}}u(p,"UINT","uint"),u(p,"FLOAT","float");class f{constructor(t){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(t=>window.setTimeout(t,1e3/60)),window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.clearTimeout,this.analyser=t.createAnalyser(),this.input=t.createGain(),this.input.connect(this.analyser),this.timeOverviewL=new n(t.sampleRate),this.timeOverviewR=new n(t.sampleRate),this.time=new h(t.sampleRate),this.fft=new p(t.sampleRate),this.analyser.fftSize=2048,this.analyser.minDecibels=-100,this.analyser.maxDecibels=-30,this.analyser.smoothingTimeConstant=.8}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"fftsize":if(void 0===e)return this.analyser.fftSize;switch(s=parseInt(e,10)){case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:this.analyser.fftSize=s}break;case"frequencybincount":return this.analyser.frequencyBinCount;case"mindecibels":if(void 0===e)return this.analyser.minDecibels;(s=parseFloat(e))<(r=-30)&&(this.analyser.minDecibels=s);break;case"maxdecibels":if(void 0===e)return this.analyser.maxDecibels;(s=parseFloat(e))>(i=-100)&&(this.analyser.maxDecibels=s);break;case"smoothingtimeconstant":if(void 0===e)return this.analyser.smoothingTimeConstant;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.analyser.smoothingTimeConstant=s)}}return this}start(t,e){let s=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"timeoverviewl":e instanceof AudioBuffer&&e.numberOfChannels>0&&((s=new Float32Array(e.length)).set(e.getChannelData(0)),this.timeOverviewL.start(s));break;case"timeoverviewr":e instanceof AudioBuffer&&e.numberOfChannels>1&&((s=new Float32Array(e.length)).set(e.getChannelData(1)),this.timeOverviewR.start(s));break;case"time":"uint"===this.time.param("type")?(s=new Uint8Array(this.analyser.fftSize),this.analyser.getByteTimeDomainData(s),this.time.start(s)):(s=new Float32Array(this.analyser.fftSize),this.analyser.getFloatTimeDomainData(s),this.time.start(s)),"auto"===this.time.param("interval")?this.time.timerid=window.requestAnimationFrame(()=>{this.start(t)}):this.time.timerid=window.setTimeout(()=>{this.start(t)},this.time.param("interval"));break;case"fft":"uint"===this.fft.param("type")?(s=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.getByteFrequencyData(s),this.fft.start(s)):(s=new Float32Array(this.analyser.frequencyBinCount),this.analyser.getFloatFrequencyData(s),this.fft.start(s,this.analyser.minDecibels,this.analyser.maxDecibels)),"auto"===this.fft.param("interval")?this.fft.timerid=window.requestAnimationFrame(()=>{this.start(t)}):this.fft.timerid=window.setTimeout(()=>{this.start(t)},this.fft.param("interval"))}return this}stop(t){switch(String(t).replace(/-/g,"").toLowerCase()){case"timeoverviewl":case"timeoverviewr":break;case"time":"auto"===this.time.param("interval")?window.cancelAnimationFrame(this.time.timerid):window.clearTimeout(this.time.timerid),this.time.timerid=null;break;case"fft":"auto"===this.fft.param("interval")?window.cancelAnimationFrame(this.fft.timerid):window.clearTimeout(this.fft.timerid),this.fft.timerid=null}return this}domain(t){const e=String(t).replace(/-/g,"").toLowerCase();switch(e){case"timeoverviewl":case"timeoverviewr":return this[`timeOverview${e.slice(-1).toUpperCase()}`];case"time":case"fft":return this[e];default:return this}}get(){return this.analyser}toString(){return"[SoundModule Analyser]"}}class d{constructor(t,e,s,i){this.sampleRate=t.sampleRate,this.context=t,this.processor=t.createScriptProcessor(e,s,i),this.mixedLs=null,this.mixedRs=null,this.numberOfTracks=0,this.trackLs=[],this.trackRs=[],this.activeTrack=-1,this.paused=!0,this.gainL=1,this.gainR=1}setup(t){const e=parseInt(t,10);if(e>0){this.numberOfTracks=e,this.trackLs=new Array(this.numberOfTracks),this.trackRs=new Array(this.numberOfTracks);for(let t=0;t<e;t++)this.trackLs[t]=[];for(let t=0;t<e;t++)this.trackRs[t]=[]}else this.numberOfTracks=1,this.trackLs=new Array(this.numberOfTracks),this.trackRs=new Array(this.numberOfTracks),this.trackLs[0]=[],this.trackRs[0]=[];return this}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"gainl":case"gainr":if(void 0===e)return this[`gain${s.slice(-1).toUpperCase()}`];i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[`gain${s.slice(-1).toUpperCase()}`]=i)}}return this}ready(t){return this.isTrack(t)?this.activeTrack=t:this.activeTrack=-1,this}start(){if(-1!==this.activeTrack&&this.paused){this.paused=!1;const t=this.processor.bufferSize;this.processor.onaudioprocess=(e=>{if(-1!==this.activeTrack){const s=e.inputBuffer.getChannelData(0),i=e.inputBuffer.getChannelData(1),r=new Float32Array(t),n=new Float32Array(t);for(let e=0;e<t;e++)r[e]=this.gainL*s[e],n[e]=this.gainR*i[e];this.trackLs[this.activeTrack].push(r),this.trackRs[this.activeTrack].push(n)}else this.processor.disconnect(0),this.processor.onaudioprocess=null})}return this}stop(){return this.activeTrack=-1,this.paused=!0,this.processor.disconnect(0),this.processor.onaudioprocess=null,this}isTrack(t){const e=parseInt(t,10);return e>=0&&e<this.numberOfTracks}getActiveTrack(){return this.activeTrack}mixTrack(t){const e=this[`track${t}s`],s={values:null,sum:0,num:0},i=this.processor.bufferSize;let r=0,n=0,a=0;for(const t of e)a<t.length&&(a=t.length);for(s.values=new Float32Array(a*i);;){for(let t=0,i=e.length;t<i;t++)e[t][r]instanceof Float32Array&&(s.sum+=e[t][r][n],s.num++);if(!(s.num>0))return s.values;{const t=r*i;s.values[t+n]=s.sum/s.num,s.sum=0,s.num=0,n<i-1?n++:(r++,n=0)}}}mix(){return-1!==this.activeTrack&&this.stop(),this.mixedLs=this.mixTrack("L"),this.mixedRs=this.mixTrack("R"),this}clear(t){if(-1!==this.activeTrack&&this.stop(),"all"===String(t).toLowerCase()){for(const t of this.trackLs)t.length=0;for(const t of this.trackRs)t.length=0}else this.isTrack(t)&&(this.trackLs[t].length=0,this.trackRs[t].length=0);return this}create(t,e,s){-1!==this.activeTrack&&this.stop();let i=null,r=null;if("all"===String(t).toLowerCase()?(this.mix(),i=this.mixedLs,r=this.mixedRs):this.isTrack(t)&&(i=this.trackLs[t-1],r=this.trackRs[t-1]),0===i.length&&0===r.length)return"";const n=1===e?1:2,a=8===s?8:16,o=1===n?Math.min(i.length,r.length):2*Math.min(i.length,r.length),c=36+o*(a/8),l=8+(28+(8+o*(a/8))),h=this.sampleRate,u=h*n*(a/8),p=o*(a/8);let f=null;switch(a){case 8:f=new Uint8Array(o);for(let t=0;t<o;t++){let e=0;(e=t%n==0?(i[Math.floor(t/n)]+1)/2*(Math.pow(2,8)-1):(r[Math.floor(t/n)]+1)/2*(Math.pow(2,8)-1))>Math.pow(2,8)-1&&(e=Math.pow(2,8)-1),e<Math.pow(2,0)-1&&(e=Math.pow(2,0)-1),f[t]=e}break;case 16:f=new Int16Array(o);for(let t=0;t<o;t++){let e=0;(e=t%n==0?i[Math.floor(t/n)]*Math.pow(2,15):r[Math.floor(t/n)]*Math.pow(2,15))>+Math.pow(2,15)-1&&(e=Math.pow(2,15)-1),e<-Math.pow(2,15)-1&&(e=-Math.pow(2,15)-1),f[t]=e}}if(window.URL=window.URL||window.webkitURL||window.mozURL,window.URL&&window.URL.createObjectURL){const t=[];t[0]=82,t[1]=73,t[2]=70,t[3]=70,t[4]=c>>0&255,t[5]=c>>8&255,t[6]=c>>16&255,t[7]=c>>24&255,t[8]=87,t[9]=65,t[10]=86,t[11]=69,t[12]=102,t[13]=109,t[14]=116,t[15]=32,t[16]=16,t[17]=0,t[18]=0,t[19]=0,t[20]=1,t[21]=0,t[22]=n,t[23]=0,t[24]=h>>0&255,t[25]=h>>8&255,t[26]=h>>16&255,t[27]=h>>24&255,t[28]=u>>0&255,t[29]=u>>8&255,t[30]=u>>16&255,t[31]=u>>24&255,t[32]=n*(a/8),t[33]=0,t[34]=a,t[35]=0,t[36]=100,t[37]=97,t[38]=116,t[39]=97,t[40]=p>>0&255,t[41]=p>>8&255,t[42]=p>>16&255,t[43]=p>>24&255;for(let e=0;e<o;e++)switch(a){case 8:t[l-p+e]=f[e];break;case 16:t[l-p+2*e+0]=f[e]>>0&255,t[l-p+2*e+1]=f[e]>>8&255}const e=new Blob([new Uint8Array(t)],{type:"audio/wav"});return window.URL.createObjectURL(e)}let d="";d+="RIFF",d+=String.fromCharCode(c>>0&255,c>>8&255,c>>16&255,c>>24&255),d+="WAVE",d+=`fmt ${String.fromCharCode(16,0,0,0)}`,d+=String.fromCharCode(1,0),d+=String.fromCharCode(n,0),d+=String.fromCharCode(h>>0&255,h>>8&255,h>>16&255,h>>24&255),d+=String.fromCharCode(u>>0&255,u>>8&255,u>>16&255,u>>24&255),d+=String.fromCharCode(n*(a/8),0),d+=String.fromCharCode(a,0),d+="data",d+=String.fromCharCode(p>>0&255,p>>8&255,p>>16&255,p>>24&255);for(let t=0;t<o;t++)switch(a){case 8:d+=String.fromCharCode(f[t]);break;case 16:d+=String.fromCharCode(f[t]>>0&255,f[t]>>8&255)}return`data:audio/wav;base64,${window.btoa(d)}`}toString(){return"[SoundModule Recorder]"}}class m{constructor(t,e,s,i,r){this.isActive=!1,this.context=t,this.analyser=r,this.sender=t.createScriptProcessor(m.BUFFER_SIZE,s,i),this.receiver=t.createScriptProcessor(m.BUFFER_SIZE,s,i),this.websocket=null,this.paused=!0}setup(t,e,s,i,r,n,a){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const o=arguments[0];"tls"in o&&(t=o.tls),"host"in o&&(e=o.host),"port"in o&&(s=o.port),"path"in o&&(i=o.path),"open"in o&&(r=o.open),"close"in o&&(n=o.close),"error"in o&&(a=o.error)}const o=t?"wss://":"ws://";"/"!==i.charAt(0)&&(i=`/${i}`);const c=parseInt(s,10);return isNaN(c)||c<0||c>65535?this:(this.websocket=new WebSocket(`${o}${e}:${c}${i}`),this.websocket.binaryType="arraybuffer",this.websocket.onopen=(t=>{"[object Function]"===Object.prototype.toString.call(r)&&r(t)}),this.websocket.onclose=(t=>{this.isActive=!1,this.paused=!0,this.connect(),"[object Function]"===Object.prototype.toString.call(n)&&n(t)}),this.websocket.onerror=(t=>{this.isActive=!1,this.paused=!0,this.connect(),"[object Function]"===Object.prototype.toString.call(a)&&a(t)}),this.websocket.onmessage=(t=>{if(!this.isActive)return this.analyser.stop("time"),void this.analyser.stop("fft");if(t.data instanceof ArrayBuffer){const e=t.data.byteLength/Float32Array.BYTES_PER_ELEMENT,s=Math.floor(e/2),i=s*Float32Array.BYTES_PER_ELEMENT,r=new Float32Array(t.data,0,s),n=new Float32Array(t.data,i,s);this.analyser.start("time"),this.analyser.start("fft"),this.receiver.onaudioprocess=(t=>{const e=t.outputBuffer.getChannelData(0),s=t.outputBuffer.getChannelData(1);r instanceof Float32Array&&e.set(r),n instanceof Float32Array&&s.set(n),this.isActive&&null!==this.websocket||(this.analyser.stop("time"),this.analyser.stop("fft"))})}}),this)}connect(){return this.receiver.disconnect(0),this.sender.disconnect(0),this.receiver.onaudioprocess=null,this.sender.onaudioprocess=null,this.isActive?(this.receiver.connect(this.analyser.input),this.receiver.connect(this.context.destination)):this.paused=!0,this}start(){if(this.isActive&&this.isConnected()&&this.paused){this.paused=!1;const t=this.sender.bufferSize;this.sender.onaudioprocess=(e=>{if(this.isActive&&this.isConnected()){const s=e.inputBuffer.getChannelData(0),i=e.inputBuffer.getChannelData(1),r=new Float32Array(2*t),n=parseInt(r.length/2,10);for(let e=0;e<t;e++)r[e]=s[e],r[n+e]=i[e];0===this.websocket.bufferedAmount&&this.websocket.send(r)}})}return this}close(){return this.websocket instanceof WebSocket&&(this.isActive=!1,this.paused=!0,this.connect(),this.websocket.close(),this.websocket=null),this}isConnected(){return this.websocket instanceof WebSocket&&this.websocket.readyState===WebSocket.OPEN}state(t,e,s){if(void 0===t)return this.isActive;"[object Function]"===Object.prototype.toString.call(s)&&s();const i=window.setInterval(()=>{this.websocket instanceof WebSocket&&0!==this.websocket.bufferedAmount||("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this.connect(),"[object Function]"===Object.prototype.toString.call(e)&&e(),window.clearInterval(i))},10);return this}get(){return this.websocket}toString(){return"[SoundModule Session]"}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(m,"BUFFER_SIZE",2048);class y{constructor(t,e){this.isActive=!0,this.context=t,this.input=t.createGain(),this.output=t.createGain(),this.lfo=t.createOscillator(),this.depth=t.createGain(),this.rate=this.lfo.frequency,this.processor=t.createScriptProcessor(e,1,2),this.lfo.start=this.lfo.start||this.lfo.noteOn,this.lfo.stop=this.lfo.stop||this.lfo.noteOff,this.values={},this.isStop=!0}param(){}connect(){}start(t){if(this.isActive&&this.isStop){let e=parseFloat(t);(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime),this.lfo.start(e),this.isStop=!1}return this}stop(t,e){if(this.isActive&&!this.isStop){let s=parseFloat(t),i=parseFloat(e);(isNaN(s)||s<this.context.currentTime)&&(s=this.context.currentTime),(isNaN(i)||i<0)&&(i=0);const r=this.lfo.type,n=this.lfo.frequency.value;this.lfo.stop(s+i),this.lfo=this.context.createOscillator(),this.lfo.start=this.lfo.start||this.lfo.noteOn,this.lfo.stop=this.lfo.stop||this.lfo.noteOff,this.lfo.type=r,this.lfo.frequency.value=n,this.rate=this.lfo.frequency,this.isStop=!0}return this}state(t){return void 0===t?this.isActive:("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this.connect(),this.start(this.context.currentTime),this)}params(){return{}}toJSON(){return JSON.stringify(this.params())}toString(){return"[SoundModule Effector]"}}class g extends y{constructor(t,e){super(t,e),this.compressor=t.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.knee.value=30,this.compressor.ratio.value=12,this.compressor.attack.value=.003,this.compressor.release.value=.25,this.state(!0)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();if(s in this.compressor){if(void 0===e)return this.compressor[s].value;const t=parseFloat(e),i={threshold:0,knee:40,ratio:20,attack:1,release:1}[s];t>={threshold:-100,knee:0,ratio:1,attack:0,release:0}[s]&&t<=i&&(this.compressor[s].value=t)}}return this}connect(){return this.input.disconnect(0),this.compressor.disconnect(0),this.isActive?(this.input.connect(this.compressor),this.compressor.connect(this.output)):this.input.connect(this.output),this}params(){return{state:this.isActive,threshold:this.compressor.threshold.value,knee:this.compressor.knee.value,ratio:this.compressor.ratio.value,attack:this.compressor.attack.value,release:this.compressor.release.value}}toString(){return"[SoundModule Compressor]"}}function b(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class v extends y{constructor(t,e){super(t,e),this.distortion=t.createWaveShaper(),this.drive=t.createGain(),this.color=t.createBiquadFilter(),this.tone=t.createBiquadFilter(),this.type=v.CLEAN,this.numberOfSamples=4096,this.drive.gain.value=1,this.color.type="string"==typeof this.color.type?"bandpass":this.color.BANDPASS||2,this.color.frequency.value=350,this.color.Q.value=Math.SQRT1_2,this.color.gain.value=0,this.tone.type="string"==typeof this.tone.type?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"curve":if(void 0===e)return this.distortion.curve;let t=null;switch(String(e).toLowerCase()){case v.CLEAN:this.type=v.CLEAN,t=v.createCurve(v.AMOUNTS.CLEAN,this.numberOfSamples);break;case v.CRUNCH:this.type=v.CRUNCH,t=v.createCurve(v.AMOUNTS.CRUNCH,this.numberOfSamples);break;case v.OVERDRIVE:this.type=v.OVERDRIVE,t=v.createCurve(v.AMOUNTS.OVERDRIVE,this.numberOfSamples);break;case v.DISTORTION:this.type=v.DISTORTION,t=v.createCurve(v.AMOUNTS.DISTORTION,this.numberOfSamples);break;case v.FUZZ:this.type=v.FUZZ,t=v.createCurve(v.AMOUNTS.FUZZ,this.numberOfSamples);break;default:e instanceof Float32Array&&(t=e)}this.distortion.curve=t;break;case"samples":if(void 0===e)return this.numberOfSamples;(i=parseInt(e,10))>=0&&(this.numberOfSamples=i,this.param("curve",this.type));break;case"drive":if(void 0===e)return this.drive.gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.drive.gain.value=i);break;case"color":case"tone":if(void 0===e)return this[s].frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this[s].frequency.value=i)}}return this}connect(){return this.input.disconnect(0),this.distortion.disconnect(0),this.drive.disconnect(0),this.color.disconnect(0),this.tone.disconnect(0),this.isActive?(this.input.connect(this.color),this.color.connect(this.distortion),this.distortion.connect(this.drive),this.drive.connect(this.tone),this.tone.connect(this.output)):this.input.connect(this.output),this}params(){return{state:this.isActive,curve:this.type,samples:this.numberOfSamples,drive:this.drive.gain.value,color:this.color.frequency.value,tone:this.tone.frequency.value}}toString(){return"[SoundModule Distortion]"}}b(v,"CLEAN","clean"),b(v,"CRUNCH","crunch"),b(v,"OVERDRIVE","overdrive"),b(v,"DISTORTION","distortion"),b(v,"FUZZ","fuzz"),b(v,"AMOUNTS",{CLEAN:0,CRUNCH:.5,OVERDRIVE:.7,DISTORTION:.8,FUZZ:.9}),b(v,"createCurve",(t,e)=>{if(t>0&&t<1){const s=new Float32Array(e),i=2*t/(1-t);for(let t=0;t<e;t++){const r=2*(t-0)/(e-0)-1;s[t]=(1+i)*r/(1+i*Math.abs(r))}return s}return null});class A extends y{constructor(t,e){super(t,e),this.lowpass=t.createBiquadFilter(),this.lowpass.type="string"==typeof this.lowpass.type?"lowpass":this.lowpass.LOWPASS||0,this.lowpass.frequency.value=350,this.lowpass.Q.value=1,this.lowpass.gain.value=0,this.depth.gain.value=0,this.rate.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"frequency":case"cutoff":if(void 0===e)return this.lowpass.frequency.value;s=parseFloat(e),i=10,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.lowpass.frequency.value=s,this.depth.gain.value=this.lowpass.frequency.value*this.depthRate);break;case"depth":if(void 0===e)return this.depthRate;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth.gain.value=this.lowpass.frequency.value*s,this.depthRate=s);break;case"rate":if(void 0===e)return this.rate.value;s=parseFloat(e),i=0,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.rate.value=s);break;case"resonance":if(void 0===e)return this.lowpass.Q.value;s=parseFloat(e),r=1e3,s>=(i=1e-4)&&s<=r&&(this.lowpass.Q.value=s)}}return this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.lowpass.frequency)),this}connect(){return this.input.disconnect(0),this.lowpass.disconnect(0),this.isActive?(this.input.connect(this.lowpass),this.lowpass.connect(this.output)):this.input.connect(this.output),this}params(){return{state:this.isActive,cutoff:this.lowpass.frequency.value,depth:this.depthRate,rate:this.rate.value,resonance:this.lowpass.Q.value}}toString(){return"[SoundModule Wah]"}}class S extends y{constructor(t,e){super(t,e),this.bass=t.createBiquadFilter(),this.middle=t.createBiquadFilter(),this.treble=t.createBiquadFilter(),this.presence=t.createBiquadFilter(),this.bass.type="string"==typeof this.bass.type?"lowshelf":this.bass.LOWSHELF||3,this.middle.type="string"==typeof this.middle.type?"peaking":this.middle.PEAKING||5,this.treble.type="string"==typeof this.treble.type?"peaking":this.treble.PEAKING||5,this.presence.type="string"==typeof this.presence.type?"highshelf":this.presence.HIGHSHELF||4,this.bass.frequency.value=500,this.middle.frequency.value=1e3,this.treble.frequency.value=2e3,this.presence.frequency.value=4e3,this.middle.Q.value=Math.SQRT1_2,this.treble.Q.value=Math.SQRT1_2,this.bass.gain.value=0,this.middle.gain.value=0,this.treble.gain.value=0,this.presence.gain.value=0,this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"bass":case"middle":case"treble":case"presence":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=40,i>=(r=-40)&&i<=n&&(this[s].gain.value=i)}}return this}connect(){return this.input.disconnect(0),this.bass.disconnect(0),this.middle.disconnect(0),this.treble.disconnect(0),this.presence.disconnect(0),this.isActive?(this.input.connect(this.bass),this.bass.connect(this.middle),this.middle.connect(this.treble),this.treble.connect(this.presence),this.presence.connect(this.output)):this.input.connect(this.output),this}params(){return{state:this.isActive,bass:this.bass.gain.value,middle:this.middle.gain.value,treble:this.treble.gain.value,presence:this.presence.gain.value}}toString(){return"[SoundModule Equalizer]"}}class w extends y{constructor(t,e){super(t,e),this.filter=t.createBiquadFilter(),this.filter.frequency.setTargetAtTime=this.filter.frequency.setTargetAtTime||this.filter.frequency.setTargetValueAtTime,this.filter.type="string"==typeof this.filter.type?"lowpass":this.filter.LOWPASS||0,this.filter.frequency.value=350,this.filter.Q.value=1,this.filter.gain.value=0,this.maxFrequency=this.filter.frequency.value,this.range=.1,this.attack=.01,this.decay=.3,this.sustain=1,this.release=1,this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"type":if(void 0===e)return this.filter.type;(i=String(e).toLowerCase())in w.FILTER_TYPES&&(this.filter.type="string"==typeof this.filter.type?i:w.FILTER_TYPES[i]);break;case"frequency":case"cutoff":if(void 0===e)return this.filter.frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.maxFrequency=i,this.filter.frequency.value=i);break;case"gain":if(void 0===e)return this.filter.gain.value;i=parseFloat(e),n=40,i>=(r=-40)&&i<=n&&(this.filter.gain.value=i);break;case"q":if(void 0===e)return this.filter.Q.value;i=parseFloat(e),n=1e3,i>=(r=1e-4)&&i<=n&&(this.filter.Q.value=i);break;case"range":if(void 0===e)return this.range;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.range=i);break;case"attack":case"sustain":if(void 0===e)return this[s];(i=parseFloat(e))>=0&&(this[s]=i);break;case"decay":case"release":if(void 0===e)return this[s];(i=parseFloat(e))>0&&(this[s]=i)}}return this}connect(){return this.input.disconnect(0),this.filter.disconnect(0),this.isActive?(this.input.connect(this.filter),this.filter.connect(this.output)):this.input.connect(this.output),this}start(t){if(this.isActive){let e=parseFloat(t);(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime);const s=e,i=s+this.attack,r=this.decay,n=this.sustain*this.maxFrequency,a=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(s),this.filter.frequency.setValueAtTime(a,s),this.filter.frequency.linearRampToValueAtTime(this.maxFrequency,i),this.filter.frequency.setTargetAtTime(n,i,r)}return this}stop(t){if(this.isActive){let e=parseFloat(t)-this.release;(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime);const s=e,i=this.release,r=this.maxFrequency*this.range;this.filter.frequency.cancelScheduledValues(s),this.filter.frequency.setValueAtTime(this.filter.frequency.value,s),this.filter.frequency.setTargetAtTime(r,s,i)}return this}state(t){return void 0===t?this.isActive:("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this.connect(),this)}params(){return{state:this.isActive,type:this.filter.type,frequency:this.filter.frequency.value,Q:this.filter.Q.value,gain:this.filter.gain.value,range:this.range,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}toString(){return"[SoundModule Filter]"}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(w,"FILTER_TYPES",{lowpass:0,highpass:1,bandpass:2,lowshelf:3,highshelf:4,peaking:5,notch:6,allpass:7});class O extends y{constructor(t,e){super(t,e),this.panner=t.createStereoPanner(),this.panner.pan.value=0,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.panner.pan)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"depth":if(void 0===e)return this.depth.gain.value;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth.gain.value=s);break;case"rate":if(void 0===e)return this.rate.value;s=parseFloat(e),i=0,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.rate.value=s)}}return this}connect(){return this.input.disconnect(0),this.panner.disconnect(0),this.isActive?(this.input.connect(this.panner),this.panner.connect(this.output)):this.input.connect(this.output),this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.panner.pan)),this}params(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value}}toString(){return"[SoundModule Autopanner]"}}class T extends y{constructor(t,e){super(t,e),this.amplitudeL=t.createGain(),this.amplitudeR=t.createGain(),this.splitter=t.createChannelSplitter(2),this.merger=t.createChannelMerger(2),this.amplitudeL.gain.value=1,this.amplitudeR.gain.value=1,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfoSplitter=t.createChannelSplitter(2),this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,0),this.lfoSplitter.connect(this.amplitudeR.gain,1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"depth":if(void 0===e)return this.depth.gain.value;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth.gain.value=s);break;case"rate":if(void 0===e)return this.rate.value;s=parseFloat(e),i=0,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.rate.value=s)}}return this}connect(){return this.input.disconnect(0),this.amplitudeL.disconnect(0),this.amplitudeR.disconnect(0),this.splitter.disconnect(0),this.splitter.disconnect(1),this.merger.disconnect(0),this.isActive?(this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0,0),this.splitter.connect(this.amplitudeR,1,0),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output)):this.input.connect(this.output),this}start(t){if(this.isActive&&this.isStop){let e=parseFloat(t);(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime),this.lfo.start(e),this.isStop=!1;const s=this.processor.bufferSize;this.processor.onaudioprocess=(t=>{const e=t.inputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);if(this.isActive&&0!==this.depth.gain.value&&0!==this.rate.value)for(let t=0;t<s;t++)i[t]=e[t],r[t]=-e[t];else for(let t=0;t<s;t++)i[t]=0,r[t]=0})}return this}stop(t,e){return super.stop(t,e),this.isActive&&(this.processor.disconnect(0),this.processor.onaudioprocess=null,this.lfo.connect(this.depth),this.depth.connect(this.processor),this.processor.connect(this.lfoSplitter),this.lfoSplitter.connect(this.amplitudeL.gain,0),this.lfoSplitter.connect(this.amplitudeR.gain,1)),this}params(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value}}toString(){return"[SoundModule AutopannerFallback]"}}class E extends y{constructor(t,e){super(t,e),this.amplitude=t.createGain(),this.amplitude.gain.value=1,this.depth.gain.value=0,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"depth":if(void 0===e)return this.depth.gain.value;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth.gain.value=s);break;case"rate":if(void 0===e)return this.rate.value;s=parseFloat(e),i=0,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.rate.value=s);break;case"wave":if(void 0===e)return this.lfo.type;(s=String(e).toLowerCase())in E.WAVE_TYPES&&(this.lfo.type="string"==typeof this.lfo.type?s:E.WAVE_TYPES[s])}}return this}connect(){return this.input.disconnect(0),this.amplitude.disconnect(0),this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output),this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)),this}params(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value,wave:this.lfo.type}}toString(){return"[SoundModule Tremolo]"}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(E,"WAVE_TYPES",{sine:0,square:1,sawtooth:2,triangle:3});class x extends y{constructor(t,e){super(t,e),this.amplitude=t.createGain(),this.amplitude.gain.value=0,this.depth.gain.value=1,this.rate.value=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"depth":if(void 0===e)return this.depth.gain.value;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth.gain.value=s);break;case"rate":if(void 0===e)return this.rate.value;s=parseFloat(e),i=0,r=this.context.sampleRate/2,s>=i&&s<=r&&(this.rate.value=s)}}return this}connect(){return this.input.disconnect(0),this.amplitude.disconnect(0),this.isActive?(this.input.connect(this.amplitude),this.amplitude.connect(this.output)):this.input.connect(this.output),this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.amplitude.gain)),this}params(){return{state:this.isActive,depth:this.depth.gain.value,rate:this.rate.value}}toString(){return"[SoundModule Ringmodulator]"}}class k extends y{constructor(t,e){super(t,e),this.numberOfStages=12,this.filters=new Array(k.MAXIMUM_STAGES);for(let e=0;e<k.MAXIMUM_STAGES;e++)this.filters[e]=t.createBiquadFilter(),this.filters[e].type="string"==typeof this.filters[e].type?"allpass":this.filters[e].ALLPASS||7,this.filters[e].frequency.value=350,this.filters[e].Q.value=1,this.filters[e].gain.value=0;this.mix=t.createGain(),this.feedback=t.createGain(),this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth);for(let t=0;t<k.MAXIMUM_STAGES;t++)this.depth.connect(this.filters[t].frequency)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"stage":if(void 0===e)return this.numberOfStages;switch(i=parseInt(e,10)){case 0:case 2:case 4:case 8:case 12:case 24:this.numberOfStages=i,this.connect()}break;case"frequency":case"cutoff":if(void 0===e)return this.filters[0].frequency.value;if(i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n){for(let t=0;t<k.MAXIMUM_STAGES;t++)this.filters[t].frequency.value=i;this.depth.gain.value=this.filters[0].frequency.value*this.depthRate}break;case"resonance":if(void 0===e)return this.filters[0].Q.value;if(i=parseFloat(e),n=1e3,i>=(r=1e-4)&&i<=n)for(let t=0;t<k.MAXIMUM_STAGES;t++)this.filters[0].Q.value=i;break;case"depth":if(void 0===e)return this.depthRate;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.depth.gain.value=this.filters[0].frequency.value*i,this.depthRate=i);break;case"rate":if(void 0===e)return this.rate.value;i=parseFloat(e),r=0,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.rate.value=i);break;case"mix":case"feedback":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[s].gain.value=i)}}return this}connect(){this.input.disconnect(0);for(let t=0;t<k.MAXIMUM_STAGES;t++)this.filters[t].disconnect(0);if(this.mix.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&this.numberOfStages>0){this.input.connect(this.filters[0]);for(let t=0;t<this.numberOfStages;t++)t<this.numberOfStages-1?this.filters[t].connect(this.filters[t+1]):(this.filters[t].connect(this.mix),this.mix.connect(this.output),this.filters[t].connect(this.feedback),this.feedback.connect(this.filters[0]))}return this}stop(t,e){if(super.stop(t,e),this.isActive){this.lfo.connect(this.depth);for(let t=0;t<k.MAXIMUM_STAGES;t++)this.depth.connect(this.filters[t].frequency)}return this}params(){return{state:this.isActive,stage:this.numberOfStages,frequency:this.filters[0].frequency.value,resonance:this.filters[0].Q.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,feedback:this.feedback.gain.value}}toString(){return"[SoundModule Phaser]"}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(k,"MAXIMUM_STAGES",24);class R extends y{constructor(t,e){super(t,e),this.delay=t.createDelay(),this.mix=t.createGain(),this.tone=t.createBiquadFilter(),this.feedback=t.createGain(),this.delay.delayTime.value=0,this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.tone.type="string"==typeof this.tone.type?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"delaytime":case"time":if(void 0===e)return this.delay.delayTime.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.delay.delayTime.value=i,this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case"depth":if(void 0===e)return this.depthRate;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.depth.gain.value=this.delay.delayTime.value*i,this.depthRate=i);break;case"rate":if(void 0===e)return this.rate.value;i=parseFloat(e),r=0,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.rate.value=i);break;case"mix":case"feedback":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[s].gain.value=i);break;case"tone":if(void 0===e)return this.tone.frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.tone.frequency.value=i)}}return this}connect(){return this.input.disconnect(0),this.delay.disconnect(0),this.mix.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)),this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)),this}params(){return{state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value}}toString(){return"[SoundModule Flanger]"}}class M extends y{constructor(t,e){super(t,e),this.delay=t.createDelay(),this.mix=t.createGain(),this.tone=t.createBiquadFilter(),this.feedback=t.createGain(),this.delay.delayTime.value=0,this.depth.gain.value=0,this.rate.value=0,this.mix.gain.value=0,this.tone.type="string"==typeof this.tone.type?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.depthRate=0,this.state(!1),this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"delaytime":case"time":if(void 0===e)return this.delay.delayTime.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.delay.delayTime.value=i,this.depth.gain.value=this.delay.delayTime.value*this.depthRate);break;case"depth":if(void 0===e)return this.depthRate;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this.depth.gain.value=this.delay.delayTime.value*i,this.depthRate=i);break;case"rate":if(void 0===e)return this.rate.value;i=parseFloat(e),r=0,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.rate.value=i);break;case"mix":case"feedback":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[s].gain.value=i);break;case"tone":if(void 0===e)return this.tone.frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.tone.frequency.value=i)}}return this}connect(){return this.input.disconnect(0),this.delay.disconnect(0),this.mix.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.input.connect(this.output),this.isActive&&(this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.mix),this.mix.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)),this}stop(t,e){return super.stop(t,e),this.isActive&&(this.lfo.connect(this.depth),this.depth.connect(this.delay.delayTime)),this}params(){return{state:this.isActive,time:this.delay.delayTime.value,depth:this.depthRate,rate:this.rate.value,mix:this.mix.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value}}toString(){return"[SoundModule Chorus]"}}class F extends y{constructor(t,e){super(t,e),this.delay=t.createDelay(F.MAX_DELAY_TIME),this.dry=t.createGain(),this.wet=t.createGain(),this.tone=t.createBiquadFilter(),this.feedback=t.createGain(),this.delay.delayTime.value=0,this.dry.gain.value=1,this.wet.gain.value=0,this.tone.type="string"==typeof this.tone.type?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.feedback.gain.value=0,this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"delaytime":case"time":if(void 0===e)return this.delay.delayTime.value;i=parseFloat(e),r=0,n=F.MAX_DELAY_TIME,i>=r&&i<=n&&(this.delay.delayTime.value=i);break;case"dry":case"wet":case"feedback":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[s].gain.value=i);break;case"tone":if(void 0===e)return this.tone.frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.tone.frequency.value=i)}}return this}connect(){return this.input.disconnect(0),this.delay.disconnect(0),this.dry.disconnect(0),this.wet.disconnect(0),this.tone.disconnect(0),this.feedback.disconnect(0),this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.delay),this.delay.connect(this.wet),this.wet.connect(this.output),this.delay.connect(this.feedback),this.feedback.connect(this.delay)):this.input.connect(this.output),this}params(){return{state:this.isActive,time:this.delay.delayTime.value,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value,feedback:this.feedback.gain.value}}toString(){return"[SoundModule Delay]"}}function N(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(F,"MAX_DELAY_TIME",5);class C extends y{constructor(t,e){super(t,e),this.rirs=[],this.convolver=t.createConvolver(),this.dry=t.createGain(),this.wet=t.createGain(),this.tone=t.createBiquadFilter(),this.dry.gain.value=1,this.wet.gain.value=0,this.tone.type="string"==typeof this.tone.type?"lowpass":this.tone.LOWPASS||0,this.tone.frequency.value=350,this.tone.Q.value=Math.SQRT1_2,this.tone.gain.value=0,this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null,r=null,n=null;switch(s){case"type":if(void 0===e)return this.convolver.buffer;i=parseInt(e,10),r=0,n=this.rirs.length-1,null===e?(this.convolver.buffer=null,this.input.disconnect(0),this.input.connect(this.output)):i>=r&&i<=n&&(this.convolver.buffer=this.rirs[i],this.connect());break;case"dry":case"wet":if(void 0===e)return this[s].gain.value;i=parseFloat(e),n=1,i>=(r=0)&&i<=n&&(this[s].gain.value=i);break;case"tone":if(void 0===e)return this.tone.frequency.value;i=parseFloat(e),r=10,n=this.context.sampleRate/2,i>=r&&i<=n&&(this.tone.frequency.value=i);break;case"rirs":return this.rirs}}return this}connect(){return this.input.disconnect(0),this.convolver.disconnect(0),this.dry.disconnect(0),this.wet.disconnect(0),this.tone.disconnect(0),this.isActive?(this.input.connect(this.dry),this.dry.connect(this.output),this.input.connect(this.tone),this.tone.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output)):this.input.connect(this.output),this}start(t,e){if(t instanceof AudioBuffer||null===t)this.convolver.buffer=t,this.rirs.push(t);else if(t instanceof ArrayBuffer){const s=t=>{this.convolver.buffer=t,this.rirs.push(t)};"[object Function]"!==Object.prototype.toString.call(e)&&(e=(()=>{})),this.context.decodeAudioData(t,s,e)}return this}preset(t,e,s,i,r){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const n=arguments[0];"rirs"in n&&(t=n.rirs),"timeout"in n&&(e=n.timeout),"success"in n&&(s=n.success),"error"in n&&(i=n.error),"progress"in n&&(r=n.progress)}Array.isArray(t)||(t=[t]),this.rirs=new Array(t.length);let n=!1;const a=parseInt(e,10),o=(t,e)=>{const o=new XMLHttpRequest;o.timeout=a>0?a:6e4,o.ontimeout=(t=>{n||"[object Function]"!==Object.prototype.toString.call(i)||i(t,C.ERROR_AJAX_TIMEOUT),n=!0}),o.onprogresss=(t=>{n?o.abort():"[object Function]"===Object.prototype.toString.call(r)&&r(t)}),o.onerror=(t=>{n||"[object Function]"!==Object.prototype.toString.call(i)||i(t,C.ERROR_AJAX),n=!0}),o.onload=(t=>{if(200===o.status){const r=o.response;if(!(r instanceof ArrayBuffer))return;const n=i=>{this.rirs[e]=i;for(let t=0,e=this.rirs.length;t<e;t++)if(void 0===this.rirs[t])return;"[object Function]"===Object.prototype.toString.call(s)&&s(t)},a=t=>{"[object Function]"===Object.prototype.toString.call(i)&&i(t,C.ERROR_DECODE)};this.context.decodeAudioData(r,n,a)}}),o.open("GET",t,!0),o.responseType="arraybuffer",o.send(null)};for(let e=0,s=t.length;e<s;e++)"string"==typeof t[e]?o(t[e],e):t[e]instanceof AudioBuffer&&(this.rirs[e]=t[e]);return this}state(t){return void 0===t?this.isActive:("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this.connect(),this)}params(){return{state:this.isActive,dry:this.dry.gain.value,wet:this.wet.gain.value,tone:this.tone.frequency.value}}toString(){return"[SoundModule Reverb]"}}function I(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}N(C,"ERROR_AJAX","error"),N(C,"ERROR_AJAX_TIMEOUT","timeout"),N(C,"ERROR_DECODE","decode");class j extends y{constructor(t,e){super(t,e),this.panner=t.createPanner(),this.positions={x:0,y:0,z:0},this.orientations={x:1,y:0,z:0},this.panner.refDistance=1,this.panner.maxDistance=1e4,this.panner.rolloffFactor=1,this.panner.coneInnerAngle=360,this.panner.coneOuterAngle=360,this.panner.coneOuterGain=0,this.panner.panningModel="string"==typeof this.panner.panningModel?"HRTF":this.panner.HRTF||1,this.panner.distanceModel="string"==typeof this.panner.distanceModel?"inverse":this.panner.INVERSE_DISTANCE||1,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z),this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z),this.state(!1)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null;switch(s){case"x":case"y":case"z":if(void 0===e)return this.positions[s];i=parseFloat(e),isNaN(i)||(this.positions[s]=i,this.panner.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case"ox":case"oy":case"oz":if(void 0===e)return this.orientations[s.charAt(1)];i=parseFloat(e),isNaN(i)||(this.orientations[s.charAt(1)]=i,this.panner.setOrientation(this.orientations.x,this.orientations.y,this.orientations.z));break;case"refdistance":if(void 0===e)return this.panner.refDistance;(i=parseFloat(e))>=0&&(this.panner.refDistance=i);break;case"maxdistance":if(void 0===e)return this.panner.maxDistance;(i=parseFloat(e))>0&&(this.panner.maxDistance=i);break;case"rollofffactor":if(void 0===e)return this.panner.rolloffFactor;i=parseFloat(e),isNaN(i)||(this.panner.rolloffFactor=i);break;case"coneinnerangle":if(void 0===e)return this.panner.coneInnerAngle;i=parseFloat(e),isNaN(i)||(this.panner.coneInnerAngle=i);break;case"coneouterangle":if(void 0===e)return this.panner.coneOuterAngle;i=parseFloat(e),isNaN(i)||(this.panner.coneOuterAngle=i);break;case"coneoutergain":if(void 0===e)return this.panner.coneOuterGain;i=parseFloat(e),isNaN(i)||(this.panner.coneOuterGain=i);break;case"panningmodel":if(void 0===e)return this.panner.panningModel;(i=/HRTF/i.test(e)?String(e).toUpperCase():String(e).toLowerCase())in j.PANNING_MODELS&&(this.panner.panningModel="string"==typeof this.panner.panningModel?i:j.PANNING_MODELS[i]);break;case"distancemodel":if(void 0===e)return this.panner.distanceModel;(i=String(e).replace(/-/g,"").toLowerCase())in j.DISTANCE_MODELS&&(this.panner.distanceModel="string"==typeof this.panner.distanceModel?i:j.DISTANCE_MODELS[i])}}return this}connect(){return this.input.disconnect(0),this.panner.disconnect(0),this.isActive?(this.input.connect(this.panner),this.panner.connect(this.output)):this.input.connect(this.output),this}params(){return{state:this.isActive,positions:this.positions,orientations:this.orientations,refDistance:this.panner.refDistance,maxDistance:this.panner.maxDistance,rolloffFactor:this.panner.rolloffFactor,coneInnerAngle:this.panner.coneInnerAngle,coneOuterAngle:this.panner.coneOuterAngle,coneOuterGain:this.panner.coneOuterGain,panningModel:this.panner.panningModel,distanceModel:this.panner.distanceModel}}toString(){return"[SoundModule Panner]"}}I(j,"PANNING_MODELS",{equalpower:0,HRTF:1}),I(j,"DISTANCE_MODELS",{linear:0,inverse:1,exponential:2});class L{constructor(t){this.listener=t.listener,this.positions={x:0,y:0,z:0},this.fronts={x:0,y:0,z:-1},this.ups={x:0,y:1,z:0},this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z),this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z)}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null;switch(s){case"x":case"y":case"z":if(void 0===e)return this.positions[s];i=parseFloat(e),isNaN(i)||(this.positions[s]=i,this.listener.setPosition(this.positions.x,this.positions.y,this.positions.z));break;case"fx":case"fy":case"fz":if(void 0===e)return this.fronts[s.charAt(1)];i=parseFloat(e),isNaN(i)||(this.fronts[s.charAt(1)]=i,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z));break;case"ux":case"uy":case"uz":if(void 0===e)return this.ups[s.charAt(1)];i=parseFloat(e),isNaN(i)||(this.ups[s.charAt(1)]=i,this.listener.setOrientation(this.fronts.x,this.fronts.y,this.fronts.z,this.ups.x,this.ups.y,this.ups.z))}}return this}params(){return{positions:this.positions,fronts:this.fronts,ups:this.ups}}toJSON(){return JSON.stringify(this.params())}toString(){return"[SoundModule Listener]"}}class _{constructor(t){this.context=t,this.generators=[],this.activeIndexes=[],this.activeCounter=0,this.attack=.01,this.decay=.3,this.sustain=.5,this.release=1}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i=null;switch(s){case"attack":case"sustain":if(void 0===e)return this[s];(i=parseFloat(e))>=0&&(this[s]=i);break;case"decay":case"release":if(void 0===e)return this[s];(i=parseFloat(e))>0&&(this[s]=i)}}return this}ready(t,e,s){const i=parseInt(t,10)>=0?parseInt(t,10):0;return e instanceof AudioNode&&s instanceof AudioNode?(e.connect(this.generators[i]),this.generators[i].connect(s)):e instanceof AudioNode?e.connect(this.generators[i]):s instanceof AudioNode&&this.generators[i].connect(s),this.activeIndexes[i]=i,this.activeCounter++,this}start(t){let e=parseFloat(t);(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime);const s=e,i=s+this.attack,r=this.decay,n=this.sustain;for(const t of this.activeIndexes)void 0!==t&&(this.generators[t].gain.cancelScheduledValues(s),this.generators[t].gain.setValueAtTime(0,s),this.generators[t].gain.linearRampToValueAtTime(1,i),this.generators[t].gain.setTargetAtTime(n,i,r));return this}stop(t){let e=parseFloat(t)-this.release;(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime);const s=e,i=this.release;for(const t of this.activeIndexes)void 0!==t&&(this.generators[t].gain.cancelScheduledValues(s),this.generators[t].gain.setValueAtTime(this.generators[t].gain.value,s),this.generators[t].gain.setTargetAtTime(0,s,i));return this}getGenerator(t){const e=parseInt(t,10)>=0?parseInt(t,10):0;return this.generators[e]}setGenerator(t){const e=parseInt(t,10)>=0?parseInt(t,10):0;return this.generators[e]=this.context.createGain(),this.generators[e].gain.setTargetAtTime=this.generators[e].gain.setTargetAtTime||this.generators[e].gain.setTargetValueAtTime,this}isStop(){let t=0;for(const e of this.activeIndexes)if(void 0!==e){if(this.generators[e].gain.value>_.MIN_GAIN)return!1;if(++t===this.activeCounter)return!0}}clear(t){this.activeIndexes.length=0,this.activeCounter=0;for(const e of this.generators)e.gain.cancelScheduledValues(this.context.currentTime),e.gain.value=1,t&&e.disconnect(0);return this}params(){return{attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}toJSON(){return JSON.stringify(this.params())}toString(){return"[SoundModule EnvelopeGenerator]"}}function D(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(_,"MIN_GAIN",.001);class P{constructor(t,e){this.init(t,e)}init(t,e){Array.isArray(this.modules)&&this.modules.length>0&&(this.mastervolume.disconnect(0),this.mastervolume=null,this.processor.disconnect(0),this.processor=null,this.analyser.input.disconnect(0),this.analyser=null,this.recorder.processor.disconnect(0),this.recorder=null,this.session.sender.disconnect(0),this.session=null,this.modules.forEach(t=>{t.input.disconnect(0),t.output.disconnect(0),t=null}),this.modules=[]),this.context=t,this.sampleRate=t.sampleRate;let s=parseInt(e,10);switch(s){case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:break;default:s=0}this.mastervolume=t.createGain(),this.processor=t.createScriptProcessor(s,P.NUMBER_OF_INPUTS,P.NUMBER_OF_OUTPUTS),this.analyser=new f(t),this.recorder=new d(t,s,P.NUMBER_OF_INPUTS,P.NUMBER_OF_OUTPUTS),this.session=new m(t,s,P.NUMBER_OF_INPUTS,P.NUMBER_OF_OUTPUTS,this.analyser),this.compressor=new g(t,s),this.distortion=new v(t,s),this.wah=new A(t,s),this.equalizer=new S(t,s),this.filter=new w(t,s),this.autopanner=t.createStereoPanner?new O(t,s):new T(t,s),this.tremolo=new E(t,s),this.ringmodulator=new x(t,s),this.phaser=new k(t,s),this.flanger=new R(t,s),this.chorus=new M(t,s),this.delay=new F(t,s),this.reverb=new C(t,s),this.panner=new j(t,s),this.listener=new L(t),this.envelopegenerator=new _(t),this.modules=[this.compressor,this.distortion,this.wah,this.equalizer,this.filter,this.autopanner,this.tremolo,this.ringmodulator,this.phaser,this.flanger,this.chorus,this.delay,this.reverb,this.panner]}setup(){}param(t,e){let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"mastervolume":if(void 0===e)return this.mastervolume.gain.value;(s=parseFloat(e))>=(i=0)&&s<=(r=1)&&(this.mastervolume.gain.value=s)}}ready(){}start(){}stop(){}get(){}resize(t){return this.init(this.context,t),this}getBufferSize(){return this.processor.bufferSize}install(t,e){return e instanceof y?String(t)in this?this:(this[t]=e,this.modules.every(t=>t!==e)&&this.modules.push(e),this):this}connect(t,e){Array.isArray(e)&&(this.modules=e),t.disconnect(0),this.modules.length>0?t.connect(this.modules[0].input):t.connect(this.mastervolume);for(let t=0,e=this.modules.length;t<e;t++)this.modules[t].output.disconnect(0),t<this.modules.length-1?this.modules[t].output.connect(this.modules[t+1].input):this.modules[t].output.connect(this.mastervolume);return this.mastervolume.connect(this.context.destination),this.mastervolume.connect(this.analyser.input),this.mastervolume.connect(this.recorder.processor),this.recorder.processor.connect(this.context.destination),this.mastervolume.connect(this.session.sender),this.session.sender.connect(this.context.destination),this}module(t){const e=String(t).replace(/-/g,"").toLowerCase();switch(e){case"analyser":case"recorder":case"session":case"compressor":case"distortion":case"wah":case"equalizer":case"filter":case"autopanner":case"tremolo":case"ringmodulator":case"phaser":case"flanger":case"chorus":case"delay":case"reverb":case"panner":case"listener":return this[e];case"envelopegenerator":case"eg":return this.envelopegenerator;case"glide":if(e in this)return this[e];case"vocalcanceler":if(e in this)return this[e];case"noisegate":if(e in this)return this[e];default:return this[e]}}on(t){let e=parseFloat(t);return(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime),this.chorus.start(e),this.flanger.start(e),this.phaser.start(e),this.autopanner.start(e),this.tremolo.start(e),this.ringmodulator.start(e),this.wah.start(e),this.filter.start(e),this}off(t){let e=parseFloat(t);return(isNaN(e)||e<this.context.currentTime)&&(e=this.context.currentTime),this.chorus.stop(e),this.flanger.stop(e),this.phaser.stop(e),this.autopanner.stop(e),this.tremolo.stop(e),this.ringmodulator.stop(e),this.wah.stop(e),this}params(){const t={};for(const e in this){if("[object Function]"===Object.prototype.toString.call(this[e]))continue;const s=e.toLowerCase();"mastervolume"===s?t[s]=this[e].gain.value:"[object Object]"===Object.prototype.toString.call(this[e])&&"params"in this[e]&&(t[s]=this[e].params())}return t}toJSON(){return JSON.stringify(this.params())}toString(){return"[SoundModule]"}}function q(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}D(P,"NUMBER_OF_INPUTS",2),D(P,"NUMBER_OF_OUTPUTS",2);class B{constructor(t,e){this.isActive=e,this.context=t,this.source=t.createOscillator(),this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable,this.source.start=this.source.start||this.source.noteOn,this.source.stop=this.source.stop||this.source.noteOff,this.volume=t.createGain(),this.isStop=!0,this.octave=0,this.fine=0,this.customs={real:new Float32Array([0,1]),imag:new Float32Array([0,1])}}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"type":if(void 0===e)return this.source.type;if("[object Object]"!==Object.prototype.toString.call(e))(s=String(e).toLowerCase())in B.WAVE_TYPES&&(this.source.type="string"==typeof this.source.type?s:B.WAVE_TYPES[s]);else if("real"in e&&"imag"in e){let t=null,s=null;if(e.real instanceof Float32Array?t=e.real:Array.isArray(e.real)&&(t=new Float32Array(e.real)),e.imag instanceof Float32Array?s=e.imag:Array.isArray(e.imag)&&(s=new Float32Array(e.imag)),t instanceof Float32Array&&s instanceof Float32Array){const e=4096;t.length>e&&(t=t.subarray(0,e)),s.length>e&&(s=s.subarray(0,e)),0!==t[0]&&(t[0]=0),0!==s[0]&&(s[0]=0);const i=this.context.createPeriodicWave(t,s);this.source.setPeriodicWave(i),this.customs.real=t,this.customs.imag=s}}break;case"octave":if(void 0===e)return this.octave;s=parseFloat(e),i=-4800/B.OCTAVE,r=4800/B.OCTAVE,s>=i&&s<=r&&(this.octave=s,this.source.detune.value=this.fine+s*B.OCTAVE);break;case"fine":if(void 0===e)return this.fine;s=parseFloat(e),i=-B.OCTAVE,r=B.OCTAVE,s>=i&&s<=r&&(this.fine=s,this.source.detune.value=s+this.octave*B.OCTAVE);break;case"volume":case"gain":if(void 0===e)return this.volume.gain.value;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.volume.gain.value=s)}}return this}ready(t){if(this.isActive){const e={type:this.source.type,frequency:this.source.frequency.value,detune:this.source.detune.value};if(this.isStop||(this.source.stop(this.context.currentTime),this.source.disconnect(0)),this.source=this.context.createOscillator(),this.source.setPeriodicWave=this.source.setPeriodicWave||this.source.setWaveTable,this.source.start=this.source.start||this.source.noteOn,this.source.stop=this.source.stop||this.source.noteOff,"custom"===e.type){const t=this.customs.real,e=this.customs.imag,s=this.context.createPeriodicWave(t,e);this.source.setPeriodicWave(s)}else this.source.type=e.type;this.source.frequency.value=e.frequency,this.source.detune.value=e.detune,this.volume.connect(t)}return this}start(t){return this.isActive?(this.source.start(t),this.isStop=!1):(this.isStop||(this.source.stop(this.context.currentTime),this.isStop=!0),this.source.disconnect(0)),this}stop(t){return this.isStop||(this.source.stop(t),this.source.disconnect(0),this.isStop=!0),this}state(t){return void 0===t?this.isActive:("toggle"===String(t).toLowerCase()?this.isActive=!this.isActive:this.isActive=Boolean(t),this)}get(){return this.source}toString(){return"[OscillatorModule Oscillator]"}}function G(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}q(B,"OCTAVE",1200),q(B,"WAVE_TYPES",{sine:0,square:1,sawtooth:2,triangle:3});class U{constructor(t){this.context=t,this.frequencies={start:-1,end:0},this.time=0,this.type=U.LINEAR}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"time":if(void 0===e)return this.time;(s=parseFloat(e))>=0&&(this.time=s);break;case"type":if(void 0===e)return this.type;(s=String(e).toLowerCase())!==U.LINEAR&&s!==U.EXPONENTIAL||(this.type=s)}}return this}ready(t){this.frequencies.end=t;const e=-1===this.frequencies.start?0:this.frequencies.end-this.frequencies.start;return-1!==this.frequencies.start&&0!==this.time&&0!==e||(this.frequencies.start=this.frequencies.end),this}start(t,e){let s=parseFloat(e);(isNaN(s)||s<this.context.currentTime)&&(s=this.context.currentTime);const i=s,r=i+this.time;return t.frequency.cancelScheduledValues(i),t.frequency.setValueAtTime(this.frequencies.start,i),t.frequency[`${this.type}RampToValueAtTime`](this.frequencies.end,r),this}stop(){return this.frequencies.start=this.frequencies.end,this}toString(){return"[OscillatorModule Glide]"}}G(U,"LINEAR","linear"),G(U,"EXPONENTIAL","exponential");class $ extends P{constructor(t){super(t),this.sources=[],this.times={start:0,stop:0},this.isAnalyser=!1,this.glide=new U(t)}setup(t){this.sources.length=0,Array.isArray(t)||(t=[t]);for(let e=0,s=t.length;e<s;e++)this.sources[e]=new B(this.context,Boolean(t[e])),this.envelopegenerator.setGenerator(e);return this}param(t,e){if("[object Object]"!==Object.prototype.toString.call(arguments[0])){const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);return void 0===i?this:i}for(const t in arguments[0])this.param(t,arguments[0][t])}ready(t,e){const s=parseFloat(t),i=parseFloat(e);return this.times.start=s>=0?s:0,this.times.stop=i>=s?i:0,this.envelopegenerator.clear(!0),this}start(t,e,s){const i=this.context.currentTime+this.times.start;Array.isArray(t)||(t=[t]);for(let e=0,s=t.length;e<s;e++){const s=parseFloat(t[e]);t[e]=s>=0?s:0}this.envelopegenerator.clear(!0),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.connect(this.processor,e);for(let e=0,s=t.length;e<s&&!(e>=this.sources.length);e++){const s=this.sources[e],r=t[e];s.ready(this.processor),this.envelopegenerator.ready(e,s.source,s.volume),this.glide.ready(r).start(s.source,i),s.start(i)}return this.envelopegenerator.start(i),this.on(i),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0),"[object Function]"===Object.prototype.toString.call(s)?this.processor.onaudioprocess=s:this.processor.onaudioprocess=(t=>{const e=t.inputBuffer.getChannelData(0),s=t.inputBuffer.getChannelData(1),i=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);if(this.envelopegenerator.isStop()){const t=this.context.currentTime;for(const e of this.sources)e.stop(t);this.off(t),this.analyser.stop("time"),this.analyser.stop("fft"),this.isAnalyser=!1,this.processor.disconnect(0),this.processor.onaudioprocess=null}else i.set(e),r.set(s)}),this}stop(){const t=this.context.currentTime+this.times.stop;return this.envelopegenerator.stop(t),this.glide.stop(),this.filter.stop(t),this}get(t){const e=parseInt(t,10);return e>=0&&e<this.sources.length?this.sources[e]:this.sources}length(){return this.sources.length}params(){const t=super.params();t.oscillator={glide:{type:this.glide.param("type"),time:this.glide.param("time")}};for(let e=0,s=this.sources.length;e<s;e++){const s=this.sources[e];t.oscillator[`oscillator${e}`]={state:s.state(),gain:s.param("gain"),type:s.param("type"),octave:s.param("octave"),fine:s.param("fine")}}return t}toString(){return"[OscillatorModule]"}}function V(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class z extends P{constructor(t){super(t),this.sources=[],this.resources=[],this.buffers=[],this.volumes=[],this.isStops=[],this.settings=[],this.times={start:0,stop:0},this.transpose=1,this.isStop=!0,this.isAnalyser=!1}setup(t,e,s,i,r,n){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const a=arguments[0];"resources"in a&&(t=a.resources),"settings"in a&&(e=a.settings),"timeout"in a&&(s=a.timeout),"success"in a&&(i=a.success),"error"in a&&(r=a.error),"progress"in a&&(n=a.progress)}Array.isArray(t)||(t=[t]),this.resources=t,Array.isArray(e)||(e=[e]),this.buffers.length=t.length;for(let t=0,s=e.length;t<s;t++){if(!("buffer"in e[t]))return this;{const s=parseInt(e[t].buffer,10);if(!(s>=0&&s<this.buffers.length))return this;e[t].buffer=s}e[t].rate="rate"in e[t]&&e[t].rate>=0?parseFloat(e[t].rate):1,e[t].loop="loop"in e[t]&&Boolean(e[t].loop),e[t].start="start"in e[t]&&e[t].start>=0?parseFloat(e[t].start):0,e[t].end="end"in e[t]&&e[t].end>=0?parseFloat(e[t].end):0,e[t].volume="volume"in e[t]&&e[t].volume>=0&&e[t].volume<=1?parseFloat(e[t].volume):1,this.isStops[t]=!0,this.volumes[t]=this.context.createGain(),this.envelopegenerator.setGenerator(t)}this.settings=e;let a=!1;const o=parseInt(s,10),c=(t,e)=>{const s=new XMLHttpRequest;s.timeout=o>0?o:6e4,s.ontimeout=(t=>{a||"[object Function]"!==Object.prototype.toString.call(r)||r(t,z.ERROR_AJAX_TIMEOUT),a=!0}),s.onprogress=(t=>{a?s.abort():"[object Function]"===Object.prototype.toString.call(n)&&n(t)}),s.onerror=(t=>{a||"[object Function]"!==Object.prototype.toString.call(r)||r(t,z.ERROR_AJAX),a=!0}),s.onload=(t=>{if(200===s.status){const n=s.response;if(!(n instanceof ArrayBuffer))return;const a=s=>{this.buffers[e]=s;for(const t of this.buffers)if(void 0===t)return;"[object Function]"===Object.prototype.toString.call(i)&&i(t,this.buffers)},o=t=>{"[object Function]"===Object.prototype.toString.call(r)&&r(t,z.ERROR_DECODE)};this.context.decodeAudioData(n,a,o)}}),s.open("GET",t,!0),s.responseType="arraybuffer",s.send(null)};for(let t=0,e=this.resources.length;t<e;t++)"string"==typeof this.resources[t]?c(this.resources[t],t):this.resources[t]instanceof AudioBuffer&&(this.buffers[t]=this.resources[t]);return this}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r=null;switch(s){case"transpose":if(void 0===e)return this.transpose;(r=parseFloat(e))>0&&(this.transpose=r)}}return this}ready(t,e){const s=parseFloat(t),i=parseFloat(e);return this.times.start=s>=0?s:0,this.times.stop=i>=s?i:0,this.envelopegenerator.clear(!1),this}start(t,e,s){const i=parseInt(t,10);if(isNaN(i)||i<0||i>=this.settings.length)return this;const r=this.settings[i].buffer,n=this.settings[i].rate,a=this.settings[i].loop,o=this.settings[i].start,c=this.settings[i].end,l=this.settings[i].volume;if(!(this.buffers[r]instanceof AudioBuffer))return this;this.sources[i]instanceof AudioBufferSourceNode&&(this.sources[i].stop(this.context.currentTime),this.sources[i].disconnect(0),this.sources[i]=null);const h=this.context.createBufferSource();h.start=h.start||h.noteGrainOn,h.stop=h.stop||h.noteOff,h.buffer=this.buffers[r],h.playbackRate.value=n*this.transpose,h.loop=a,h.loopStart=o,h.loopEnd=c,this.volumes[i].gain.value=l,this.envelopegenerator.clear(!1),this.envelopegenerator.ready(i,h,this.volumes[i]),this.volumes[i].connect(this.processor),this.connect(this.processor,e);const u=this.context.currentTime+this.times.start;return h.start(u),this.sources[i]=h,this.envelopegenerator.start(u),this.on(u),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0),this.isStops[i]=!1,this.times.stop>0&&window.setTimeout(()=>{this.stop(i)},1e3*this.times.stop),h.onended=(()=>{this.isStops[i]=!0}),"[object Function]"===Object.prototype.toString.call(s)?this.processor.onaudioprocess=s:this.processor.onaudioprocess=(t=>{if(this.isStop=this.isStops.every(t=>t),this.isStop)this.off(this.context.currentTime),this.envelopegenerator.clear(!1),this.analyser.stop("time"),this.analyser.stop("fft"),this.isAnalyser=!1,this.processor.disconnect(0),this.processor.onaudioprocess=null;else{const e=t.inputBuffer.getChannelData(0),s=t.inputBuffer.getChannelData(1),i=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);i.set(e),r.set(s)}}),this}stop(t){const e=parseInt(t,10);if(isNaN(e)||e<0||e>=this.settings.length)return this;const s=this.settings[e].buffer;if(!(this.buffers[s]instanceof AudioBuffer&&this.sources[e]instanceof AudioBufferSourceNode))return this;const i=this.context.currentTime+this.times.stop;return this.envelopegenerator.stop(i),this.filter.stop(i),this}get(t){const e=parseInt(t,10);return e>=0&&e<this.buffers.length?this.buffers[e]:this.buffers}params(){const t=super.params();return t.oneshot={transpose:this.transpose},t}reset(t,e,s){const i=parseInt(t,10);return String(e).toLowerCase()in this.settings[i]&&(this.settings[i][e.toLowerCase()]=s),this}toString(){return"[OneshotModule]"}}function X(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}V(z,"ERROR_AJAX","error"),V(z,"ERROR_AJAX_TIMEOUT","timeout"),V(z,"ERROR_DECODE","decode");class W extends P{constructor(t){super(t),this.type=W.WHITE_NOISE,this.envelopegenerator.setGenerator(0),this.isAnalyser=!1}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r="";switch(s){case"type":if(void 0===e)return this.type;(r=String(e).toLowerCase())!==W.WHITE_NOISE&&r!==W.PINK_NOISE&&r!==W.BROWNIAN_NOISE||(this.type=r)}}return this}start(t){this.envelopegenerator.clear(!0),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.connect(this.envelopegenerator.getGenerator(0),t),this.envelopegenerator.ready(0,this.processor),this.envelopegenerator.start(this.context.currentTime),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0);const e=this.processor.bufferSize;let s=0;return this.processor.onaudioprocess=(t=>{const i=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);if(this.envelopegenerator.isStop())this.processor.disconnect(0),this.processor.onaudioprocess=null,this.analyser.stop("time"),this.analyser.stop("fft"),this.isAnalyser=!1;else switch(this.type){case W.WHITE_NOISE:for(let t=0;t<e;t++)i[t]=2*(Math.random()-.5),r[t]=2*(Math.random()-.5);break;case W.PINK_NOISE:let t=0,n=0,a=0,o=0,c=0,l=0,h=0;for(let s=0;s<e;s++){const e=2*Math.random()-1;t=.99886*t+.0555179*e,n=.99332*n+.0750759*e,a=.969*a+.153852*e,o=.8665*o+.3104856*e,c=.55*c+.5329522*e,l=-.7616*l-.016898*e,i[s]=t+n+a+o+c+l+h+.5362*e,r[s]=t+n+a+o+c+l+h+.5362*e,i[s]*=.11,r[s]*=.11,h=.115926*e}break;case W.BROWNIAN_NOISE:for(let t=0;t<e;t++){const e=2*Math.random()-1;i[t]=(s+.02*e)/1.02,r[t]=(s+.02*e)/1.02,s=(s+.02*e)/1.02,i[t]*=3.5,r[t]*=3.5}}}),this}stop(){return this.envelopegenerator.stop(this.context.currentTime),this}toString(){return"[NoiseModule]"}}X(W,"WHITE_NOISE","whitenoise"),X(W,"PINK_NOISE","pinknoise"),X(W,"BROWNIAN_NOISE","browniannoise");class H{constructor(){this.depth=0}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"depth":if(void 0===e)return this.depth;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.depth=s)}}return this}start(t,e){return t-this.depth*e}toString(){return"[AudioModule VocalCanceler]"}}class Q extends P{constructor(t){super(t),this.source=t.createBufferSource(),this.buffer=null,this.currentTime=0,this.paused=!0,this.callbacks={decode:()=>{},ready:()=>{},start:()=>{},stop:()=>{},update:()=>{},ended:()=>{},error:()=>{}},this.vocalcanceler=new H}setup(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.setup(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();s in this.callbacks&&"[object Function]"===Object.prototype.toString.call(e)&&(this.callbacks[s]=e)}return this}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;let r=0,n=0,a=0;switch(s){case"playbackrate":if(void 0===e)return this.source.playbackRate.value;r=parseFloat(e),a=1024,r>=(n=0)&&r<=a&&(this.source.playbackRate.value=r);break;case"loop":case"looping":if(void 0===e)return this.source.loop;this.source.loop=Boolean(e);break;case"currenttime":if(void 0===e)return this.currentTime;this.buffer instanceof AudioBuffer?(r=parseFloat(e),a=this.buffer.duration,r>=(n=0)&&r<=a&&(this.paused?this.currentTime=r:(this.stop(),this.start(r)))):this.currentTime=0;break;case"duration":return this.buffer instanceof AudioBuffer?this.buffer.duration:0;case"samplerate":return this.buffer instanceof AudioBuffer?this.buffer.sampleRate:this.sampleRate;case"channels":return this.buffer instanceof AudioBuffer?this.buffer.numberOfChannels:0}}return this}ready(t){if(t instanceof ArrayBuffer){const e=t=>{this.buffer=t,this.analyser.start("timeOverviewL",t),this.analyser.start("timeOverviewR",t),this.callbacks.ready(t)};this.context.decodeAudioData(t,e,this.callbacks.error),this.callbacks.decode(t)}return this}start(t,e,s){if(this.buffer instanceof AudioBuffer&&this.paused){const i=this.context.currentTime,r=parseFloat(t);this.currentTime=r>=0&&r<=this.buffer.duration?r:0;const n=this.source.playbackRate.value,a=this.source.loop;this.source=this.context.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.buffer=this.buffer,this.source.playbackRate.value=n,this.source.loop=a,this.source.connect(this.processor),this.connect(this.processor,e),this.source.start(i,r,this.buffer.duration-r),this.analyser.start("time"),this.analyser.start("fft"),this.paused=!1,this.on(i),this.callbacks.start(this.source,this.currentTime);const o=this.processor.bufferSize;"[object Function]"===Object.prototype.toString.call(s)?this.processor.onaudioprocess=s:this.processor.onaudioprocess=(t=>{const e=t.inputBuffer.getChannelData(0),s=t.inputBuffer.getChannelData(1),i=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1);if(this.currentTime<Math.floor(this.source.buffer.duration)){for(let t=0;t<o;t++)i[t]=this.vocalcanceler.start(e[t],s[t]),r[t]=this.vocalcanceler.start(s[t],e[t]),this.currentTime+=1*this.source.playbackRate.value/this.source.buffer.sampleRate,this.callbacks.update(this.source,this.currentTime);this.analyser.timeOverviewL.update(this.currentTime),this.analyser.timeOverviewR.update(this.currentTime)}else this.source.loop?this.currentTime=0:this.end()})}return this}stop(){if(this.buffer instanceof AudioBuffer&&!this.paused){const t=this.context.currentTime;this.source.stop(t),this.off(t),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.paused=!0,this.callbacks.stop(this.source,this.currentTime)}return this}get(){return this.source}toggle(t,e,s){return this.paused?this.start(t,e,s):this.stop(),this}end(){return this.stop(),this.currentTime=0,this.callbacks.ended(this.source,this.currentTime),this}isBuffer(){return this.buffer instanceof AudioBuffer}isSource(){return this.source instanceof AudioBufferSourceNode&&this.source.buffer instanceof AudioBuffer}isPaused(){return this.paused}params(){const t=super.params();return t.audio={playbackrate:this.isSource()?this.source.playbackRate.value:1,vocalcanceler:{depth:this.vocalcanceler.param("depth")}},t}toString(){return"[AudioModule]"}}function J(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Y extends Q{constructor(t){super(t),this.source=null,this.media=null,this.ext="",this.playbackRate=1,this.controls=!1,this.loop=!1,this.muted=!1,this.autoplay=!1,this.listeners={}}setup(t,e,s,i){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const r=arguments[0];"media"in r&&(t=r.media),"formats"in r&&(e=r.formats),"listeners"in r&&(s=r.listeners),"autoplay"in r&&(i=r.autoplay)}let r="";if(t instanceof HTMLAudioElement)r=Y.AUDIO;else{if(!(t instanceof HTMLVideoElement))return this;r=Y.VIDEO}this.media=t,Array.isArray(e)||(e=[e]);for(const t of e){const e=`${r}/${String(t).toLowerCase()}`;if(/^(?:maybe|probably)/.test(this.media.canPlayType(e))){this.ext=t;break}}if("[object Object]"===Object.prototype.toString.call(s))for(const t in s)this.listeners[t.toLowerCase()]="[object Function]"===Object.prototype.toString.call(s[t])?s[t]:()=>{};this.autoplay=Boolean(i),!this.autoplay||this.source instanceof MediaElementAudioSourceNode||(this.source=this.context.createMediaElementSource(this.media)),this.autoplay&&this.stop(()=>this.start(this.media.currentTime),()=>{}),this.media.addEventListener("loadstart",t=>{this.source instanceof MediaElementAudioSourceNode||(this.source=this.context.createMediaElementSource(this.media)),"loadstart"in this.listeners&&this.listeners.loadstart(t)},!1),this.media.addEventListener("ended",t=>{this.media.pause(),this.off(this.context.currentTime),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,"ended"in this.listeners&&this.listeners.ended(t)},!1);for(const t in this.listeners)this.media.addEventListener(t,t=>{this.listeners[t.type.toLowerCase()](t)},!1);return this}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase();let i;if("mastervolume"===s&&(i=super.param(s,e)),void 0!==i)return i;let r=null,n=null,a=null;switch(s){case"playbackrate":if(void 0===e)return this.media instanceof HTMLMediaElement?this.media.playbackRate:this.playbackRate;(r=parseFloat(e))>=(n=.5)&&(this.media instanceof HTMLMediaElement&&(this.media.playbackRate=r),this.playbackRate=r);break;case"currenttime":if(void 0===e)return this.media instanceof HTMLMediaElement?this.media.currentTime:0;this.media instanceof HTMLMediaElement&&(r=parseFloat(e),n=0,a=this.media.duration,r>=n&&r<=a&&(this.media.currentTime=r));break;case"loop":case"muted":case"controls":if(void 0===e)return this.media instanceof HTMLMediaElement?this.media[s]:this[s];this.media instanceof HTMLMediaElement&&(this.media[s]=Boolean(e)),this[s]=Boolean(e);break;case"width":case"height":if(void 0===e)return this.media instanceof HTMLVideoElement?this.media[s]:0;(r=parseInt(e,10))>=(n=0)&&this.media instanceof HTMLVideoElement&&(this.media[s]=r);break;case"duration":return this.media.duration;case"channels":return this.source instanceof MediaElementAudioSourceNode?this.source.channelCount:0}}return this}ready(t){const e=String(t);try{-1!==e.indexOf("data:")||-1!==e.indexOf("blob:")||""===this.ext?this.media.src=e:this.media.src=`${e}.${this.ext}`}catch(t){throw new Error("The designated resource cannot be loaded.")}return this}start(t,e,s){if(this.source instanceof MediaElementAudioSourceNode&&this.media.paused){this.source.connect(this.processor),this.connect(this.processor,e),this.media.play().then(()=>{const e=parseFloat(t);this.media.currentTime=e>=0&&e<=this.media.duration?e:0,this.media.playbackRate=this.playbackRate,this.media.controls=this.controls,this.media.loop=this.loop,this.media.muted=this.muted,this.on(this.context.currentTime),this.analyser.start("time"),this.analyser.start("fft");const i=this.processor.bufferSize;"[object Function]"===Object.prototype.toString.call(s)?this.processor.onaudioprocess=s:this.processor.onaudioprocess=(t=>{const e=t.inputBuffer.getChannelData(0),s=t.inputBuffer.getChannelData(1),r=t.outputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(1);for(let t=0;t<i;t++)r[t]=this.vocalcanceler.start(e[t],s[t]),n[t]=this.vocalcanceler.start(s[t],e[t])})}).catch(()=>{this.stop(()=>{this.autoplay&&(this.media.muted=this.muted=!0,this.media.volume=0),this.start(t,e,s)},()=>{})})}return this}stop(t,e){return this.source instanceof MediaElementAudioSourceNode&&!this.media.paused&&this.media.play().then(()=>(this.media.pause(),this.off(this.context.currentTime),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,"[object Function]"===Object.prototype.toString.call(t)&&t(),Promise.resolve())).catch(t=>("[object Function]"===Object.prototype.toString.call(e)&&e(t),Promise.reject(t))),this}get(){return this.source}toggle(t,e,s){return this.media.paused?this.start(t,e,s):this.stop(),this}isMedia(){return this.media instanceof HTMLMediaElement}isSource(){return this.source instanceof MediaElementAudioSourceNode}isPaused(){return!(this.media instanceof HTMLMediaElement)||this.media.paused}params(){const t=super.params();return t.media={playbackrate:this.playbackRate,vocalcanceler:{depth:this.vocalcanceler.param("depth")}},delete t.audio,t}requestPictureInPicture(){return this.media instanceof HTMLVideoElement&&"pictureInPictureEnabled"in document&&document.pictureInPictureEnabled?this.media.disablePictureInPicture?Promise.reject():0===this.media.readyState?Promise.reject():this.media===document.pictureInPictureElement?Promise.reject():this.media.requestPictureInPicture():Promise.reject()}exitPictureInPicture(){return this.media instanceof HTMLVideoElement&&"pictureInPictureEnabled"in document&&document.pictureInPictureEnabled?this.media.disablePictureInPicture?Promise.reject():0===this.media.readyState?Promise.reject():this.media!==document.pictureInPictureElement?Promise.reject():document.exitPictureInPicture():Promise.reject()}toString(){return"[MediaModule]"}}J(Y,"AUDIO","audio"),J(Y,"VIDEO","video");class Z{constructor(){this.level=0}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{let s=null,i=null,r=null;switch(String(t).replace(/-/g,"").toLowerCase()){case"level":if(void 0===e)return this.level;s=parseFloat(e),r=1,s>=(i=0)&&s<=r&&(this.level=s)}}return this}start(t){return Math.abs(parseFloat(t))>this.level?t:0}toString(){return"[StreamModule NoiseGate]"}}class K extends P{constructor(t){super(t),this.source=null,this.constraints={audio:!0,video:!1},this.callbacks={stream:()=>{},error:()=>{}},this.output=!0,this.isStop=!0,this.noisegate=new Z}setup(t,e,s){return"[object Object]"===Object.prototype.toString.call(t)&&(this.constraints=t),"[object Function]"===Object.prototype.toString.call(e)&&(this.callbacks.stream=e),"[object Function]"===Object.prototype.toString.call(s)&&(this.callbacks.error=s),this}param(t,e){if("[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.param(t,arguments[0][t]);else{const s=String(t).replace(/-/g,"").toLowerCase(),i=super.param(s,e);if(void 0!==i)return i;switch(s){case"output":if(void 0===e)return this.output;this.output=Boolean(e)}}return this}ready(){return this}start(t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Cannot use WebRTC.");const s=this.processor.bufferSize;let i=!1;const r=(t,e,r)=>{this.source=this.context.createMediaStreamSource(t),this.source.connect(this.processor),this.connect(this.processor,e),this.output||(this.mastervolume.disconnect(0),this.mastervolume.connect(this.analyser.input),this.mastervolume.connect(this.recorder.processor),this.recorder.processor.connect(this.context.destination),this.mastervolume.connect(this.session.sender),this.session.sender.connect(this.context.destination)),this.on(this.context.currentTime),i||(this.analyser.start("time"),this.analyser.start("fft"),i=!0),"[object Function]"===Object.prototype.toString.call(r)?this.processor.onaudioprocess=r:this.processor.onaudioprocess=(t=>{const e=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1),r=t.outputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(1);for(let t=0;t<s;t++)r[t]=this.noisegate.start(e[t]),n[t]=this.noisegate.start(i[t])})};return this.isStop=!1,navigator.mediaDevices.getUserMedia(this.constraints).then(s=>{this.isStop||(r(s,t,e),this.callbacks.stream(s))}).catch(t=>{this.callbacks.error(t)}),this}stop(){return this.source=null,this.off(this.context.currentTime,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.processor.disconnect(0),this.processor.onaudioprocess=null,this.isStop=!0,this}get(){return this.source}toggle(t,e){return this.isStreaming()?this.stop():this.start(t,e),this}isStreaming(){return!this.isStop}params(){const t=super.params();return t.stream={output:this.output,noisegate:{level:this.noisegate.param("level")}},t}toString(){return"[StreamModule]"}}class tt extends P{constructor(t){super(t),this.sources=[],this.isAnalyser=!1}mix(t){Array.isArray(t)||(t=[t]),this.sources=t;for(const t of this.sources){if(!(t instanceof $||t instanceof z||t instanceof Q||t instanceof Y||t instanceof K))return this;const e=this.context.currentTime;this.off(e,!1),t.analyser.stop("time"),t.analyser.stop("fft"),t.isAnalyser=!1,t.recorder.stop(),t.session.close(),t.processor.disconnect(0),t.processor.connect(this.processor)}this.connect(this.processor);const e=this.context.currentTime;return this.on(e),this.isAnalyser||(this.analyser.start("time"),this.analyser.start("fft"),this.isAnalyser=!0),this.processor.onaudioprocess=(e=>{const s=e.inputBuffer.getChannelData(0),i=e.inputBuffer.getChannelData(1),r=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);let a=!1;for(const e of t)e instanceof $&&e.envelopegenerator.isStop()?a=!0:e instanceof z&&e.isStop?a=!0:e instanceof Q&&e.paused?a=!0:e instanceof Y&&e.media.paused?a=!0:e instanceof K&&e.isStop&&(a=!0);if(a){const t=this.context.currentTime;this.on(t,!0),this.analyser.stop("time"),this.analyser.stop("fft"),this.isAnalyser=!1,this.processor.disconnect(0),this.processor.onaudioprocess=null}else r.set(s),n.set(i)}),this}get(t){const e=parseInt(t,10);return e>=0&&e<this.sources.length?this.sources[e]:this.sources}toString(){return"[MixerModule]"}}class et{constructor(t){this.context=t,this.midiAccess=null,this.inputs=[],this.outputs=[]}setup(t,e,s){if(!navigator.requestMIDIAccess)throw new Error("Cannot use Web MIDI API.");return navigator.requestMIDIAccess({sysex:Boolean(t)}).then(t=>{if(this.midiAccess=t,"[object Function]"===Object.prototype.toString.call(t))this.inputs=t.inputs(),this.outputs=t.outputs();else{const e=t.inputs.values(),s=t.outputs.values();for(let t=e.next();!t.done;t=e.next())this.inputs.push(t.value);for(let t=s.next();!t.done;t=s.next())this.outputs.push(t.value)}"[object Function]"===Object.prototype.toString.call(e)&&e(this.midiAccess,this.inputs,this.outputs)}).catch(t=>{"[object Function]"===Object.prototype.toString.call(s)&&s(t)}),this}get(){return this.midiAccess}toString(){return"[MIDI]"}}function st(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class it{constructor(t){this.context=t,this.source=null,this.sequences=[],this.timerids=[],this.prev=[],this.offset=0,this.callbacks={start:()=>{},stop:()=>{},ended:()=>{},error:()=>{}}}setup(t,e){if(arguments.length>0&&"[object Object]"===Object.prototype.toString.call(arguments[0]))for(const t in arguments[0])this.setup(t,arguments[0][t]);else if(arguments.length>1){const s=String(t).toLowerCase();s in this.callbacks&&"[object Function]"===Object.prototype.toString.call(e)&&(this.callbacks[s]=e)}return this}ready(t,e,s){if(this.offset=parseInt(s,10),null!==this.source&&this.stop(),this.sequences.length=0,this.timerids.length=0,this.prev.length=0,Array.isArray(t)){for(const e of t)if(!(e instanceof OscillatorNode))return this;this.source=t}else if(t instanceof OscillatorNode)this.source=[t];else{if(!(t instanceof $||t instanceof z))return this;this.source=t}for(Array.isArray(e)||(e=[e]);e.length>0;){const t=[],s=String(e.shift()).match(it.REGEXP_MML);if(null===s)return void this.callbacks.error(it.ERROR_STRING,"");let i=[],r=[],n=0,a=0,o=0,c=0,l=null,h=null;for(;s.length>0;){const e=s.shift().trim();if(it.REGEXP_TEMPO.test(e)){const t=parseInt(e.slice(1),10);if(!(t>0))return void this.callbacks.error(it.ERROR_TEMPO,e);l=it.ONE_MINUTES/t}else if(it.REGEXP_OCTAVE.test(e)){if((h=parseInt(e.slice(1),10))<0)return void this.callbacks.error(it.ERROR_OCTAVE,e)}else if(it.REGEXP_NOTE.test(e)){if(null===l)return void this.callbacks.error(it.ERROR_TEMPO,e);if(null===h)return void this.callbacks.error(it.ERROR_OCTAVE,e);const s=e.match(it.REGEXP_CHORD)[1];i=[];for(let t=0,r=s.length;t<r;t++){const r=s.charAt(t);let n=it.computeIndex(h,r.toUpperCase());switch(s.charAt(t+1)){case"#":case"+":n++,t++;break;case"-":n--,t++}if(n>=i[0]&&(n-=it.EQUAL_TEMPERAMENT),n<0)return void this.callbacks.error(it.ERROR_NOTE,e);i.push(n)}r=[];for(const t of i){const s=t!==it.REST?it.computeFrequency(t):0;if(-1===s)return void this.callbacks.error(it.ERROR_NOTE,e);r.push(s)}const u=e.split("&");for(;u.length>0;){const t=u.shift().match(it.REGEXP_DURATION)[1];switch(parseInt(t,10)){case 1:case 2:case 4:case 8:case 16:case 32:case 64:case 128:case 256:const s=it.QUARTER_NOTE/parseInt(t,10);a+=-1!==t.indexOf(".")?1.5*s*l:s*l;break;case 6:a+=2*l/3;break;case 12:a+=l/3;break;case 18:a+=2*l/9;break;case 24:a+=.5*l/3;break;case 36:a+=l/9;break;case 48:a+=.25*l/3;break;case 72:a+=.5*l/9;break;case 96:a+=.125*l/3;break;case 144:a+=.25*l/9;break;case 192:a+=.0625*l/3;break;default:this.callbacks.error(it.ERROR_NOTE,e)}}o=(n=c)+a,c+=a,t.push({indexes:i,frequencies:r,start:n,duration:a,stop:o}),a=0}}t.length>0&&(t.reverse(),this.sequences.push(t),this.timerids.push(null))}return this}start(t,e,s){const i=parseInt(t,10);if(i>=0&&i<this.sequences.length){if(!Array.isArray(this.sequences[i]))return this;if(0===this.sequences[i].length)return this.stop(s),this.callbacks.ended(),this;const t=this.sequences[i].pop();if(Array.isArray(this.source)){for(let s=0,i=this.source.length;s<i;s++){let i=this.source[s];const r=i.type,n=i.detune.value;if((i=this.context.createOscillator()).start=i.start||i.noteOn,i.stop=i.stop||i.noteOff,i.type=r,i.frequency.value=t.frequencies[s],i.detune.value=n,Array.isArray(e)){i.connect(e[0]);for(let t=0,s=e.length;t<s;t++){const i=e[t];if(t<s-1){const s=e[t+1];if(!(i instanceof AudioNode&&s instanceof AudioNode))return this;i.connect(s)}else i.connect(this.context.destination)}}else i.connect(this.context.destination);i.start(this.context.currentTime),i.stop(this.context.currentTime+t.duration),this.source[s]=i}for(let e=0,s=t.indexes.length;e<s;e++)this.callbacks.start(t,e)}else if(this.source instanceof $){this.source.start(t.frequencies,e,s);for(let e=0,s=t.indexes.length;e<s;e++)this.callbacks.start(t,e)}else if(this.source instanceof z)for(let i=0,r=t.indexes.length;i<r;i++)t.indexes[i]!==it.REST&&this.source.start(t.indexes[i]+this.offset,e,s),this.callbacks.start(t,i,this.offset);this.timerids[i]=window.setTimeout(()=>{if(Array.isArray(this.source))for(let e=0,s=t.indexes.length;e<s;e++)this.callbacks.start(t,e);else if(this.source instanceof $){this.source.stop();for(let e=0,s=t.indexes.length;e<s;e++)this.callbacks.stop(t,e)}else if(this.source instanceof z)for(let e=0,i=t.indexes.length;e<i;e++)t.indexes[e]!==it.REST&&this.source.stop(t.indexes[e]+this.offset,s),this.callbacks.stop(t,e,this.offset);this.prev=t,this.start(i,e,s)},1e3*t.duration)}return this}stop(t){const e=this.prev;if(0===e.length)return this;if(Array.isArray(this.source))for(const t of e.indexes)this.callbacks.stop(e,t);else if(this.source instanceof $){this.source.stop();for(const t of e.indexes)this.callbacks.stop(e,t)}else if(this.source instanceof z)for(const s of e.indexes)s!==it.REST&&this.source.stop(s+this.offset,t),this.callbacks.stop(e,s,this.offset);for(let t=0,e=this.timerids.length;t<e;t++)window.clearTimeout(this.timerids[t]),this.timerids[t]=null;return this}get(t){const e=parseInt(t,10);return e>=0&&e<this.sequences.length?this.sequences[e]:this.sequences}toggle(t,e,s){return this.isPaused()?this.start(t,e,s):this.stop(),this}isSequences(){return Array.isArray(this.sequences[0])}isPaused(){for(const t of this.timerids)if(null!=t)return!1;return!0}toABC(t,e,s,i,r,n){let a="";a+=`X:${e||1}\n`,a+=`T:${s||""}\n`,a+=`M:${i||"4/4"}\n`,a+=`L:${r||"1/256"}\n`,a+=`K:${n||""}\n`;const o=t.match(it.REGEXP_MML);if(null===o)return a;let c=null,l=0;for(;o.length>0;){const t=o.shift().trim();if(it.REGEXP_TEMPO.test(t)){const e=parseInt(t.slice(1),10);if(!(e>0))return a;a+=`Q:1/4=${e}\n`}else if(it.REGEXP_OCTAVE.test(t)){if((c=parseInt(t.slice(1),10))<0)return a}else if(it.REGEXP_NOTE.test(t)){if(null===c)return a;let e=null;e=-1===t.indexOf("&")?[t]:t.split("&");let s="";for(;e.length>0;){const t=e.shift();let i="",r=0;switch(parseInt(t.replace(/^.+?(\d+)\.*$/,"$1"),10)){case 1:i=t.replace("1","256");break;case 2:i=t.replace("2","128");break;case 4:i=t.replace("4","64");break;case 8:i=t.replace("8","32");break;case 16:i=t.replace("16","16");break;case 32:i=t.replace("32","8");break;case 64:i=t.replace("64","4");break;case 128:i=t.replace("128","2");break;case 256:i=t.replace("256","1");break;case 6:i=`(3${t.replace("6","128")}`,r=128/3;break;case 12:i=`(3${t.replace("12","64")}`,r=64/3;break;case 18:i=`(9${t.replace("18","128")}`,r=128/9;break;case 24:i=`(3${t.replace("24","32")}`,r=32/3;break;case 36:i=`(9${t.replace("36","64")}`,r=64/9;break;case 48:i=`(3${t.replace("48","16")}`,r=16/3;break;case 72:i=`(9${t.replace("72","32")}`,r=32/9;break;case 96:i=`(3${t.replace("96","8")}`,r=8/3;break;case 144:i=`(9${t.replace("144","16")}`,r=16/9;break;case 192:i=`(3${t.replace("192","4")}`,r=4/3;break;default:return a}if(-1!==i.indexOf(".")&&(i=i.replace(/^(.+?)\d+\.+$/,`$1${1.5*parseInt(i.replace(/^.+?(\d+)\.+$/,"$1"),10)}`)),-1===i.indexOf("(")?l+=parseInt(i.replace(/^.+?(\d+)\.*$/i,"$1"),10):l+=r,l>=256&&(i+=" | ",l=0),/R/i.test(i)){a+=`${i} `;continue}let n="";switch(c){case 0:n=",,,,";break;case 1:n=",,,";break;case 2:n=",,";break;case 3:n=",";break;case 5:n="'";break;case 6:n="''";break;case 7:n="'''"}const o=i.match(/^(\(\d+)?((?:[CDEFGAB][#+-]?)+)(.*)$/i);if(null===o)return a;const h=o[1]?o[1]:"",u=o[2].length,p=o[3]?o[3]:"";let f=0;if(h.length>0&&(i=i.replace(/^(?:\(\d+)?((?:[CDEFGAB][#+-]?)+)(.*)$/i,"$1$2")),1===u)s+=`${h}${i.slice(0,1)}${n}${p}`;else if(2===u&&/[#+-]/.test(i.charAt(1)))s+=`${h}${i.slice(1,2)}${i.slice(0,1)}${n}${p}`;else for(;f<u;)0===f&&(s+=`${h}[`),/[#+-]/.test(i.charAt(f+1))?(s+=`${i.slice(f+1,f+2)}${i.slice(f,f+1)}${n}`,f+=2):(s+=`${i.slice(f,f+1)}${n}`,f++),f===u&&(s+=`]${p}`);e.length>0?s+="&":a+=`${s} `}}}return a.replace(/R/gi,"z").replace(/[#+]/g,"^").replace(/-/g,"_").replace(/&/g,"-").replace(/\s{2}/g," ")}toString(){return"[MML]"}}function rt(t,e,s,i,r){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const n=arguments[0];"file"in n&&(t=n.file),"type"in n&&(e=n.type),"success"in n&&(s=n.success),"error"in n&&(i=n.error),"progress"in n&&(r=n.progress)}if(!(t instanceof Blob))return void("[object Function]"===Object.prototype.toString.call(i)&&i(null,"FILE_IS_NOT_BLOB"));const n=new FileReader;n.onprogress=(t=>{"[object Function]"===Object.prototype.toString.call(r)&&r(t)}),n.onerror=(t=>{if("[object Function]"===Object.prototype.toString.call(i)){let e="";switch(n.error.code){case n.error.NOT_FOUND_ERR:e="NOT_FOUND_ERR";break;case n.error.SECURITY_ERR:e="SECURITY_ERR";break;case n.error.ABORT_ERR:e="ABORT_ERR";break;case n.error.NOT_READABLE_ERR:e="NOT_READABLE_ERR";break;case n.error.ENCODING_ERR:e="ENCODING_ERR";break;default:e="ERR"}i(t,e)}}),n.onload=(t=>{if("[object Function]"===Object.prototype.toString.call(s)){let e=n.result;"string"==typeof e&&-1===e.indexOf("data:")&&-1===e.indexOf("blob:")&&(e=e.replace(/<(\/?script.*?)>/gi,"&lt;$1&gt;")),s(t,e)}}),/arraybuffer/i.test(e)?n.readAsArrayBuffer(t):/dataurl/i.test(e)?n.readAsDataURL(t):/text/i.test(e)&&n.readAsText(t,"UTF-8")}st(it,"ONE_MINUTES",60),st(it,"EQUAL_TEMPERAMENT",12),st(it,"QUARTER_NOTE",4),st(it,"REGEXP_MML",/\s*(?:T\d+)\s*|\s*(?:O\d+)\s*|\s*(?:(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*\s*/gi),st(it,"REGEXP_TEMPO",/T\d+/i),st(it,"REGEXP_OCTAVE",/O\d+/i),st(it,"REGEXP_NOTE",/(?:(?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)(?:&(?:[CDEFGABR][#+-]?)+(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?)*/i),st(it,"REGEXP_CHORD",/((?:[CDEFGABR][#+-]?)+)(?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*/i),st(it,"REGEXP_DURATION",/(?:[CDEFGABR][#+-]?)+((?:256|192|144|128|96|72|64|48|36|32|24|18|16|12|8|6|4|2|1)\.?.*)/i),st(it,"REST","R"),st(it,"ERROR_STRING","MML"),st(it,"ERROR_TEMPO","TEMPO"),st(it,"ERROR_OCTAVE","OCTAVE"),st(it,"ERROR_NOTE","NOTE"),st(it,"computeIndex",(t,e)=>{let s=0;switch(e){case"C":s=3;break;case"D":s=5;break;case"E":s=7;break;case"F":s=8;break;case"G":s=10;break;case"A":s=12;break;case"B":s=14;break;case it.REST:return it.REST}const i=it.EQUAL_TEMPERAMENT*(t-1)+s;return i>=0?i:-1}),st(it,"computeFrequency",t=>{const e=Math.pow(2,1/12);return t>=0?27.5*Math.pow(e,t):-1});const nt="undefined"!=typeof window?window:{};let at;nt.AudioContext=nt.AudioContext||nt.webkitAudioContext;const ot=Boolean(nt.AudioContext);if(ot){const t=new AudioContext;t.createScriptProcessor=t.createScriptProcessor||t.createJavaScriptNode,t.createGain=t.createGain||t.createGainNode,t.createDelay=t.createDelay||t.createDelayNode,t.createPeriodicWave=t.createPeriodicWave||t.createWaveTable;const e={oscillator:new $(t),oneshot:new z(t),noise:new W(t),audio:new Q(t),media:new Y(t),stream:new K(t),mixer:new tt(t),midi:new et(t),mml:new it(t)};(at=((t,s)=>{const i=String(t).replace(/-/g,"").toLowerCase();switch(i){case"oscillator":if(void 0===s)return e.oscillator;const t=parseInt(s,10);return t>=0&&t<e.oscillator.length()?e.oscillator.get(t):null;case"oneshot":case"noise":case"audio":case"media":case"stream":case"mixer":case"midi":case"mml":return e[i];default:return null}})).IS_XSOUND=ot,at.SAMPLE_RATE=t.sampleRate,at.NUMBER_OF_INPUTS=P.NUMBER_OF_INPUTS,at.NUMBER_OF_OUTPUTS=P.NUMBER_OF_OUTPUTS,at.ajax=function(t,e,s,i,r){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const n=arguments[0];"url"in n&&(t=n.url),"timeout"in n&&(e=n.timeout),"success"in n&&(s=n.success),"error"in n&&(i=n.error),"progress"in n&&(r=n.progress)}const n=new XMLHttpRequest,a=parseInt(e,10);n.timeout=a>0?a:6e4,n.ontimeout=(t=>{"[object Function]"===Object.prototype.toString.call(i)&&i(t,"timeout")}),n.onprogress=(t=>{"[object Function]"===Object.prototype.toString.call(r)&&r(t)}),n.onerror=(t=>{"[object Function]"===Object.prototype.toString.call(i)&&i(t,"error")}),n.onload=(t=>{if(200===n.status){const e=n.response;e instanceof ArrayBuffer&&"[object Function]"===Object.prototype.toString.call(s)&&s(t,e)}}),n.open("GET",t,!0),n.responseType="arraybuffer",n.send(null)},at.convertTime=function(t){const e=parseFloat(t);if(e>=0)return{minutes:Math.floor(e/60),seconds:Math.floor(e%60),milliseconds:e-parseInt(e,10)}},at.decode=function(t,e,s,i){if(t instanceof AudioContext&&e instanceof ArrayBuffer)return"[object Function]"!==Object.prototype.toString.call(s)&&(s=(()=>{})),"[object Function]"!==Object.prototype.toString.call(i)&&(i=(()=>{})),t.decodeAudioData(e,s,i)},at.exitFullscreen=function(){if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(document.cancelFullScreen)document.cancelFullScreen();else{if(!document.exitFullscreen)throw new Error("Cannot exit from full screen.");document.exitFullscreen()}},at.file=function(t,e,s,i,r){if("[object Object]"===Object.prototype.toString.call(arguments[0])){const n=arguments[0];"event"in n&&(t=n.event),"type"in n&&(e=n.type),"success"in n&&(s=n.success),"error"in n&&(i=n.error),"progress"in n&&(r=n.progress)}if(!(t instanceof Event))return;let n=null;if("drop"===t.type)t.stopPropagation(),t.preventDefault(),n=t.dataTransfer.files[0];else{if(!("change"===t.type&&"files"in t.target))return;n=t.target.files[0]}if(n instanceof File){if(/text/i.test(e)&&-1===n.type.indexOf("text"))throw new Error("Please upload text file.");if(/arraybuffer|dataurl/i.test(e)&&!/audio|video/.test(n.type))throw new Error("Please upload audio or video file.");return/objecturl/i.test(e)?(window.URL=window.URL||window.webkitURL||window.mozURL,window.URL.createObjectURL(n)):(rt({file:n,type:e,success:s,error:i,progress:r}),n)}throw new Error("Please upload file.")},at.fullscreen=function(t){if(t instanceof Element)if(t.webkitRequestFullscreen)t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.msRequestFullscreen)t.msRequestFullscreen();else{if(!t.requestFullscreen)throw new Error("Cannot change to full screen.");t.requestFullscreen()}},at.read=rt,at.toFrequencies=function(t){const e=Math.pow(2,1/12);Array.isArray(t)||(t=[t]);const s=new Array(t.length);for(let i=0,r=t.length;i<r;i++){const r=parseInt(t[i],10);s[i]=r>=0?27.5*Math.pow(e,r):0}return s},at.toTextFile=function(t){return`data:text/plain;base64,${window.btoa((t=>{let e="";for(let s=0,i=t.length;s<i;s++){const i=t.charCodeAt(s);e+=i>255?`&#${i};`:t.charAt(s)}return e})(String(t)))}`},at.Effector=y,at.setup=(()=>"running"!==t.state?t.resume():Promise.reject()),at.clone=(()=>{const e={oscillator:new $(t),oneshot:new z(t),noise:new W(t),audio:new Q(t),media:new Y(t),stream:new K(t),mixer:new tt(t),midi:new et(t),mml:new it(t)},s=(t,s)=>{const i=String(t).replace(/-/g,"").toLowerCase();switch(i){case"oscillator":if(void 0===s)return e.oscillator;const t=parseInt(s,10);return t>=0&&t<e.oscillator.length()?e.oscillator.get(t):null;case"oneshot":case"noise":case"audio":case"media":case"stream":case"mixer":case"midi":case"mml":return e[i];default:return null}};return s.free=(t=>{Array.isArray(t)||(t=[t]);for(const s of t)if(null!==s)for(const t in e)s===e[t]&&(e[t]=null)}),s}),at.free=(t=>{Array.isArray(t)||(t=[t]);for(const s of t)if(null!==s)for(const t in e)s===e[t]&&(e[t]=null)}),at.noConflict=(t=>(window.X===at&&(window.X=void 0),t&&window.XSound===at&&(window.XSound=void 0),at)),at.get=(()=>t),at.getCurrentTime=(()=>t.currentTime),at.toString=(()=>"[XSound]");const s=navigator.userAgent.toLowerCase();if(-1!==s.indexOf("chrome")&&-1===s.indexOf("edge")){const t=()=>{at.setup().then(()=>{}).catch(()=>{}),document.removeEventListener("click",t,!0),document.removeEventListener("mousedown",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0)};document.addEventListener("click",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0)}}else(at=(()=>null)).IS_XSOUND=ot;nt.XSound=at,nt.X=at,"undefined"!=typeof exports&&(exports.XSound=at,exports.X=at)}]);
//# sourceMappingURL=xsound.js.map